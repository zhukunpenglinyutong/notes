<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.Node项目仿知乎API.md | Notes</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="知识速查（了不起的个人工具库）">
    <link rel="preload" href="/assets/css/0.styles.f5078b10.css" as="style"><link rel="preload" href="/assets/js/app.a28e9894.js" as="script"><link rel="preload" href="/assets/js/2.b5be6ff6.js" as="script"><link rel="preload" href="/assets/js/99.ec48a5d6.js" as="script"><link rel="preload" href="/assets/js/3.87d40112.js" as="script"><link rel="prefetch" href="/assets/js/10.35e5e2b7.js"><link rel="prefetch" href="/assets/js/100.f00dc9e9.js"><link rel="prefetch" href="/assets/js/101.f9639423.js"><link rel="prefetch" href="/assets/js/102.c5475d9e.js"><link rel="prefetch" href="/assets/js/103.da7ae3cf.js"><link rel="prefetch" href="/assets/js/104.665c45d5.js"><link rel="prefetch" href="/assets/js/105.e176f192.js"><link rel="prefetch" href="/assets/js/106.c8828b80.js"><link rel="prefetch" href="/assets/js/107.c4340427.js"><link rel="prefetch" href="/assets/js/108.719b7c9c.js"><link rel="prefetch" href="/assets/js/109.87ea0b38.js"><link rel="prefetch" href="/assets/js/11.229c04a5.js"><link rel="prefetch" href="/assets/js/110.d2eeb993.js"><link rel="prefetch" href="/assets/js/111.d3bcb22c.js"><link rel="prefetch" href="/assets/js/112.72258ddc.js"><link rel="prefetch" href="/assets/js/12.0b67de50.js"><link rel="prefetch" href="/assets/js/13.c38d4c68.js"><link rel="prefetch" href="/assets/js/14.ac4bdd84.js"><link rel="prefetch" href="/assets/js/15.f33def02.js"><link rel="prefetch" href="/assets/js/16.9f8d4d27.js"><link rel="prefetch" href="/assets/js/17.16c18b67.js"><link rel="prefetch" href="/assets/js/18.36c1d685.js"><link rel="prefetch" href="/assets/js/19.05742e9a.js"><link rel="prefetch" href="/assets/js/20.0423b7e1.js"><link rel="prefetch" href="/assets/js/21.70845d4e.js"><link rel="prefetch" href="/assets/js/22.9fe53ad0.js"><link rel="prefetch" href="/assets/js/23.fe054a0e.js"><link rel="prefetch" href="/assets/js/24.48aca476.js"><link rel="prefetch" href="/assets/js/25.d873c7a2.js"><link rel="prefetch" href="/assets/js/26.7154f1f5.js"><link rel="prefetch" href="/assets/js/27.09768527.js"><link rel="prefetch" href="/assets/js/28.bfaa30dd.js"><link rel="prefetch" href="/assets/js/29.5ebfc24c.js"><link rel="prefetch" href="/assets/js/30.eeb8c354.js"><link rel="prefetch" href="/assets/js/31.88e796c1.js"><link rel="prefetch" href="/assets/js/32.4bb414c3.js"><link rel="prefetch" href="/assets/js/33.9925562b.js"><link rel="prefetch" href="/assets/js/34.d89f5cb4.js"><link rel="prefetch" href="/assets/js/35.85ad812c.js"><link rel="prefetch" href="/assets/js/36.12266af3.js"><link rel="prefetch" href="/assets/js/37.ebd37158.js"><link rel="prefetch" href="/assets/js/38.b063f9b2.js"><link rel="prefetch" href="/assets/js/39.eeb074c2.js"><link rel="prefetch" href="/assets/js/4.02bf3d71.js"><link rel="prefetch" href="/assets/js/40.cb8dfeba.js"><link rel="prefetch" href="/assets/js/41.31231b50.js"><link rel="prefetch" href="/assets/js/42.d39b5fdb.js"><link rel="prefetch" href="/assets/js/43.e3cc9b3d.js"><link rel="prefetch" href="/assets/js/44.18be67b1.js"><link rel="prefetch" href="/assets/js/45.2008d378.js"><link rel="prefetch" href="/assets/js/46.97fe3010.js"><link rel="prefetch" href="/assets/js/47.69114193.js"><link rel="prefetch" href="/assets/js/48.14215855.js"><link rel="prefetch" href="/assets/js/49.7eb885ee.js"><link rel="prefetch" href="/assets/js/5.d572fee8.js"><link rel="prefetch" href="/assets/js/50.1e65a98b.js"><link rel="prefetch" href="/assets/js/51.11130cf1.js"><link rel="prefetch" href="/assets/js/52.e37db22c.js"><link rel="prefetch" href="/assets/js/53.6e95c85c.js"><link rel="prefetch" href="/assets/js/54.dd9a4e29.js"><link rel="prefetch" href="/assets/js/55.9776ad3c.js"><link rel="prefetch" href="/assets/js/56.1bee5f73.js"><link rel="prefetch" href="/assets/js/57.ef85c37a.js"><link rel="prefetch" href="/assets/js/58.b566d49a.js"><link rel="prefetch" href="/assets/js/59.5fb6bca7.js"><link rel="prefetch" href="/assets/js/6.68b83dc0.js"><link rel="prefetch" href="/assets/js/60.498fd1e2.js"><link rel="prefetch" href="/assets/js/61.a402dc0f.js"><link rel="prefetch" href="/assets/js/62.639a2732.js"><link rel="prefetch" href="/assets/js/63.f9d81c98.js"><link rel="prefetch" href="/assets/js/64.66659b4e.js"><link rel="prefetch" href="/assets/js/65.d4b444c4.js"><link rel="prefetch" href="/assets/js/66.e4b0c082.js"><link rel="prefetch" href="/assets/js/67.64f606c7.js"><link rel="prefetch" href="/assets/js/68.11beb140.js"><link rel="prefetch" href="/assets/js/69.2bdb150b.js"><link rel="prefetch" href="/assets/js/7.9ba505b6.js"><link rel="prefetch" href="/assets/js/70.22a28ed0.js"><link rel="prefetch" href="/assets/js/71.5225f919.js"><link rel="prefetch" href="/assets/js/72.16ac4f39.js"><link rel="prefetch" href="/assets/js/73.85d2131d.js"><link rel="prefetch" href="/assets/js/74.6f083167.js"><link rel="prefetch" href="/assets/js/75.95ff534d.js"><link rel="prefetch" href="/assets/js/76.c51ffffe.js"><link rel="prefetch" href="/assets/js/77.7588cc7a.js"><link rel="prefetch" href="/assets/js/78.7c05a122.js"><link rel="prefetch" href="/assets/js/79.0eb7a7d6.js"><link rel="prefetch" href="/assets/js/8.6639ecf1.js"><link rel="prefetch" href="/assets/js/80.a2b1574a.js"><link rel="prefetch" href="/assets/js/81.503dd8b0.js"><link rel="prefetch" href="/assets/js/82.bbfabd85.js"><link rel="prefetch" href="/assets/js/83.aa2ce4eb.js"><link rel="prefetch" href="/assets/js/84.88b65ec1.js"><link rel="prefetch" href="/assets/js/85.7308a591.js"><link rel="prefetch" href="/assets/js/86.8cfe8f13.js"><link rel="prefetch" href="/assets/js/87.09937984.js"><link rel="prefetch" href="/assets/js/88.a861e5dd.js"><link rel="prefetch" href="/assets/js/89.59cc03bf.js"><link rel="prefetch" href="/assets/js/9.dac21db2.js"><link rel="prefetch" href="/assets/js/90.f085f31b.js"><link rel="prefetch" href="/assets/js/91.eca0b451.js"><link rel="prefetch" href="/assets/js/92.5d212955.js"><link rel="prefetch" href="/assets/js/93.4e6f6fab.js"><link rel="prefetch" href="/assets/js/94.8256448b.js"><link rel="prefetch" href="/assets/js/95.a78f6d18.js"><link rel="prefetch" href="/assets/js/96.4668611c.js"><link rel="prefetch" href="/assets/js/97.30f8e4a6.js"><link rel="prefetch" href="/assets/js/98.6891e985.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f5078b10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/1.quickcheck/" class="nav-link">
  速查
</a></div><div class="nav-item"><a href="/2.note/" class="nav-link router-link-active">
  前端体系
</a></div><div class="nav-item"><a href="/3.other/" class="nav-link">
  其他
</a></div> <a href="https://github.com/zhukunpenglinyutong/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/1.quickcheck/" class="nav-link">
  速查
</a></div><div class="nav-item"><a href="/2.note/" class="nav-link router-link-active">
  前端体系
</a></div><div class="nav-item"><a href="/3.other/" class="nav-link">
  其他
</a></div> <a href="https://github.com/zhukunpenglinyutong/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>0.计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1.HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2.CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3.JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4.jQuery及其周边库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5.1MVVM框架（Vue）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5.2MVVM框架（React）</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6.移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>7.Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.0网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.1前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.2 前端安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.3前端性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.4前端代码质量</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.5运维</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.6前端架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>9.项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2.note/9.项目/1.Node项目仿知乎API.html" class="active sidebar-link">1.Node项目仿知乎API.md</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🔥序章" class="sidebar-link">🔥序章</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌴第一章-认识restful-api" class="sidebar-link">🌴第一章：认识RESTful API</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌳第二章-用koa-说-hello-world" class="sidebar-link">🌳第二章：用Koa 说 Hello World</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🎄第三章-koa-和-restful-api-的最佳实践" class="sidebar-link">🎄第三章：Koa 和 RESTful API 的最佳实践</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌵第四章-koa框架的控制器以及设计更合理的目录结构" class="sidebar-link">🌵第四章：koa框架的控制器以及设计更合理的目录结构</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌱第五章-多种方案实现错误处理机制" class="sidebar-link">🌱第五章：多种方案实现错误处理机制</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌿第六章-koa-mongodb-实现增删改查" class="sidebar-link">🌿第六章：koa + MongoDB 实现增删改查</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🎋第七章-jwt在koa框架中实现用户的认证与授权" class="sidebar-link">🎋第七章：JWT在Koa框架中实现用户的认证与授权</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🐲第八章-上传图片模块" class="sidebar-link">🐲第八章：上传图片模块</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🍀第九章-个人资料模块" class="sidebar-link">🍀第九章：个人资料模块</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌳第十章-关注与粉丝模块" class="sidebar-link">🌳第十章：关注与粉丝模块</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌴第十一章-话题模块" class="sidebar-link">🌴第十一章：话题模块</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌱第十二章-问题模块" class="sidebar-link">🌱第十二章：问题模块</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌿第十三章-答案模块" class="sidebar-link">🌿第十三章：答案模块</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌾第十四章-评论模块" class="sidebar-link">🌾第十四章：评论模块</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#🌿第十五章-项目上线-部署" class="sidebar-link">🌿第十五章：项目上线，部署</a></li><li class="sidebar-sub-header"><a href="/2.note/9.项目/1.Node项目仿知乎API.html#📚参考列表-最后更新2019-6-23-23-23" class="sidebar-link">📚参考列表（最后更新2019.6.23 23:23）</a></li></ul></li><li><a href="/2.note/9.项目/2.行为封装软件.html" class="sidebar-link">2.软件开发行为封装软件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_1-node项目仿知乎api-md"><a href="#_1-node项目仿知乎api-md" class="header-anchor">#</a> 1.Node项目仿知乎API.md</h1> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意此处：此处内容需要重新梳理</p></div> <hr> <h2 id="🔥序章"><a href="#🔥序章" class="header-anchor">#</a> 🔥序章</h2> <p><strong>本项目采用 Koa2 + mongoose 作为基础，采用JWT做鉴权（Token），是我熟悉Koa2 + MongoDB开发的入门项目</strong></p> <ul><li>收获一：抽离出一个 Koa + mongoose 的MVC简单项目 <a href="https://github.com/zhukunpenglinyutong/Koa-api-template" target="_blank" rel="noopener noreferrer">项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>收获二：加深了 RESTful API 的规范认知，见下面的笔记</li></ul> <hr> <h2 id="🌴第一章-认识restful-api"><a href="#🌴第一章-认识restful-api" class="header-anchor">#</a> 🌴第一章：认识RESTful API</h2> <hr> <h3 id="_1-rest是什么以及它的6个限制"><a href="#_1-rest是什么以及它的6个限制" class="header-anchor">#</a> 1.REST是什么以及它的6个限制</h3> <ul><li><strong>什么是REST</strong>：REST是一种架构风格，用来创建网络服务</li> <li><strong>为何叫REST</strong>：英语全称是 Representational State Transfer
<ul><li>Representational：数据表示形式，可以用很多种，一般用JSON</li> <li>State：当前状态或者数据</li> <li>Transfer：数据传输</li></ul></li></ul> <p><strong>通过字面意思来看是不好理解的，或者说不全面的，但是我们可以通过REST的六个限制来更深刻的认识REST</strong></p> <ul><li>客户-服务器（Clent-Server）（这个解释非常的好🔥）
<ul><li>关注点分离（服务端关注数据存储，提升了简单性；前端专注用户界面，提高了可移植性）</li> <li>简单性解释：过去服务端端还需要渲染页面，现在只需要写好数据存储就好了</li> <li>可移植性解释：调用接口，渲染平台的能力，很多平台都支持这种操作</li></ul></li> <li>无状态（Stateless）
<ul><li>所有用户会话信息都保存在客户端</li> <li>每次去请求必须包括所有信息，不能依赖上下文信息（例如小说翻页，你想请求下一页，服务器不知道下一页是啥，需要你确定的请求第几页才行）</li> <li>🔥无状态的好处：服务端不用保存会话信息，提升了简单性，可靠性，可见性</li></ul></li> <li>缓存（Cache）
<ul><li>所有服务端响应都要标记可缓存或者不可缓存</li> <li>缓存的好处：减少前后端交互，提升了性能</li></ul></li> <li>统一接口（Uniform Interface）🔥
<ul><li>接口设计尽可能统一通用，提升了简单性，可见性</li> <li>接口与实现解耦，使前后端可以独立开发迭代（接口定好之后，前端可以自己mock数据，不用等后端开发完成）</li></ul></li> <li>分层系统（Layered System）
<ul><li>每层只知道相邻的一层，后面隐藏的就不知道了</li> <li>客户端不知道是在和代理还是真正的服务器通信</li> <li>其他层：安全层，负载均衡层，缓存层等（阿里巴巴有个机构专门做这种层的，不用关系业务逻辑）</li></ul></li> <li>按需代码（Code-On-Demand可选）（不是很重要）
<ul><li>客户端可以下载运行服务端传过来代码（例如JS）</li> <li>减少一些功能，简化客户端</li></ul></li></ul> <hr> <h3 id="_2-统一接口限制-接口需要统一成什么样子"><a href="#_2-统一接口限制-接口需要统一成什么样子" class="header-anchor">#</a> 2.统一接口限制（接口需要统一成什么样子？）</h3> <ul><li>资源的标识
<ul><li>资源是任何可以命名的的事物，比如用户，评论等</li> <li>每个资源通过URL被统一的标识（例如：https://api.github.com/users）</li></ul></li> <li>通过表述来操作资源（这个我懂，我就是这样用的）
<ul><li>客户端不能直接操作（比如SQL）服务端资源</li> <li>客户端应该通过表述（比如JSON）来操作资源</li></ul></li> <li>自描述信息
<ul><li>每个消息（请求或者响应）必须踢狗足够的信息让接受者理解</li> <li>例如：你可以需要传媒体类型（application/json,application/xml）</li> <li>例如：你需要规定请求类型：GET,POST,DELETE</li> <li>例如：响应是否被缓存：Cache-Control</li></ul></li> <li>超媒体作为应用状态引擎（没懂）
<ul><li>...</li></ul></li></ul> <p>后记：GitHub api 有 v3，也就是 REST API,还有 v4 GraphQL api 学完v3可以看下v4</p> <hr> <h3 id="_3-restful-api简介"><a href="#_3-restful-api简介" class="header-anchor">#</a> 3.RESTful API简介</h3> <ul><li>字面解释是：符合REST架构风格的API</li> <li>RESTful API 具体长什么样子呢？
<ul><li>基本的URL，例如:https//api.github.com/users</li> <li>标准HTTP方法，例如 GET,POST,PUT,PATCH,DELETE</li> <li>传输的数据媒体类型，如JSON，XML</li></ul></li> <li>现实举例
<ul><li>GET /users | 获取user列表</li> <li>GET /users/12 | 查看某个具体的user</li> <li>POST /users | 创建一个user</li> <li>PUT /users/12 | 更新user为12的用户</li> <li>DELETE /users/12 | 删除user为12的用户</li></ul></li></ul> <hr> <h3 id="_4-restful-api设计最佳实践-规范化-对我很重要-🔥"><a href="#_4-restful-api设计最佳实践-规范化-对我很重要-🔥" class="header-anchor">#</a> 4.RESTful API设计最佳实践（规范化，对我很重要）🔥</h3> <ul><li>请求设计规范 ✅
<ul><li>URL要使用名词，尽量用复数，如 /users</li> <li>URL使用嵌套表示关联关系，如 /users/12/repos/5</li> <li>使用正确的HTTP方法，如 GET/POST/PUT/DELETE</li> <li>不符合增删改查的情况下：POST/...</li></ul></li> <li>响应设计规范 ✅
<ul><li>查询（每一个返回值都是可以被查询的，也就是我们加上返回条件，就能筛选我们想要的结果）</li> <li>分页</li> <li>字段过滤（完整的字段假如有十个，这个可以规定我想要的字段）</li> <li>状态码</li> <li>错误处理（如果错了，要规范化的返回错误信息）</li></ul></li> <li>安全（这个也是有收获的）✅
<ul><li>使用HTTPS（使用HTTP容易被篡改，加上一些广告什么的，很烦）</li> <li>鉴权（需要登录才能请求某些接口）</li> <li>限流（防止某些坏人刻意占用接口）</li></ul></li> <li>开发者优化
<ul><li>文档</li> <li>超媒体</li></ul></li></ul> <hr> <h2 id="🌳第二章-用koa-说-hello-world"><a href="#🌳第二章-用koa-说-hello-world" class="header-anchor">#</a> 🌳第二章：用Koa 说 Hello World</h2> <h3 id="_1-koa简介"><a href="#_1-koa简介" class="header-anchor">#</a> 1.Koa简介</h3> <ul><li>一句话简介：基于Node.js的下一代web框架
<ul><li>基于Node.js：说明koa是一个Node.js模块</li> <li>下一代：蚕食第一代Express市场</li> <li>web框架：不是命令行工具，不是算法</li></ul></li> <li>官网详细介绍
<ul><li>由Experss幕后人原班人马打造</li> <li>Web应用和API开发领域</li> <li>更小，更富有表现力，更健壮</li> <li>利用async函数，丢弃回调函数</li> <li>增强错误处理：try catch</li> <li>没有捆绑任何中间件</li> <li>快速而愉快的编写程序（画的一个大饼）</li></ul></li></ul> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/1.png"> <hr> <h3 id="_2-安装搭建第一个koa程序"><a href="#_2-安装搭建第一个koa程序" class="header-anchor">#</a> 2.安装搭建第一个Koa程序</h3> <ul><li>初始化目录：npm i koa --save</li> <li>使用：建立 app.js，让koa返回一个 hello world</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//use() 方法里面可以传递函数，这个函数就是我们说的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="_3-koa中间件与洋葱模型"><a href="#_3-koa中间件与洋葱模型" class="header-anchor">#</a> 3.Koa中间件与洋葱模型</h3> <ul><li>async/await 示例（当一个请求依赖上个请求完成的情况下，需要用嵌套，这个非常的不优雅）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这个可是解决了我不能在任何地方用 async 的方法</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span> <span class="token comment">// 嵌套一</span>
  <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span> <span class="token comment">// 嵌套二</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>学习编写Koa中间件</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//use() 方法里面可以传递函数，这个函数就是我们说的中间件,这是一个中间件，执行多个中间件，必须要写 next 参数 🔥🔥🔥</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我也是中间件，我要先执行'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>

</code></pre></div><p><strong>洋葱模型</strong></p> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/2.png"> <hr> <h2 id="🎄第三章-koa-和-restful-api-的最佳实践"><a href="#🎄第三章-koa-和-restful-api-的最佳实践" class="header-anchor">#</a> 🎄第三章：Koa 和 RESTful API 的最佳实践</h2> <h3 id="_1-路由简介"><a href="#_1-路由简介" class="header-anchor">#</a> 1.路由简介</h3> <ul><li>路由决定了不同的URL是如何被 不同执行的</li> <li>在Koa中，路由的本质是一个中间件</li> <li>思考，如果没有路由会怎么样？请求和响应都没法 差异化，请求和返回的结果都一样，就跟上面我们返回的 Hello World一样，这.....是不行的</li> <li>路由存在的意义：处理不同的URL，处理不同的http请求，解析URL上的参数</li></ul> <hr> <h3 id="_2-自己编写koa路由中间件"><a href="#_2-自己编写koa路由中间件" class="header-anchor">#</a> 2.自己编写Koa路由中间件</h3> <ul><li>目标实现功能：处理不同的URL，处理不同的http方法，解析URL上的参数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//use() 方法里面可以传递函数，这个函数就是我们说的中间件,这是一个中间件，执行多个中间件，必须要写 next 参数</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ① 处理不同的URL：ctx.url 表示上下文的URL，ctx表示上下文</span>
  <span class="token comment">// ② 处理不同的http方法：ctx.method</span>
  <span class="token comment">// ③ 解析URL上的参数 </span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">路径：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，请求类型：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 参数：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getURLParameters</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取url中的参数</span>
<span class="token keyword">function</span> <span class="token function">getURLParameters</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/([^?=&amp;]+)(=([^&amp;]*))/g</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> params<span class="token operator">?</span>params<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="_3-使用koa-router实现路由"><a href="#_3-使用koa-router实现路由" class="header-anchor">#</a> 3.使用Koa-router实现路由</h3> <ul><li>安装：npm i koa-router --save</li></ul> <p><strong>基本使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">;</span>

<span class="token comment">// 注册路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'这是首页'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 解析URL参数</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">这是用户</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 注册router中间件（要用router中的routes()方法）</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>路由前缀和多中间件使用（这里使用不规范，整理以后比较规范的结构）</strong></p> <hr> <h3 id="_4-http-options-方法的用-额-对我目前没太大用-就是增加些知识广度"><a href="#_4-http-options-方法的用-额-对我目前没太大用-就是增加些知识广度" class="header-anchor">#</a> 4.HTTP options 方法的用（额，对我目前没太大用，就是增加些知识广度）</h3> <ul><li>🔥options 是HTTP请求类型中的一种（GET,POST......）</li> <li>这是一道常考面试题，还可以帮助理解 koa-router 的 allowedMethods 的作用</li> <li><strong>🔥options 作用</strong> <ul><li>检测服务器所支持的请求方法</li> <li>CORS中的预见请求</li></ul></li> <li><strong>allowedMethods 作用</strong> <ul><li>响应 options 方法，告诉所支持的请求方法</li> <li>相应的返回 405（不允许）和 501（没实现）</li></ul></li></ul> <hr> <h3 id="🔥5-增删改查应该返回什么响应"><a href="#🔥5-增删改查应该返回什么响应" class="header-anchor">#</a> 🔥5.增删改查应该返回什么响应？</h3> <p><strong>这里听说是最佳实践，但是我观点是，我再看看，选择适合自己的</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">;</span>

<span class="token comment">// 增</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// 返回新建的数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 删</span>
router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">204</span> <span class="token comment">// 返回状态码 204，表示没有内容，但是成功了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 改</span>
router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// 返回修改后的数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 查</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// 返回数据列表</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 注册router中间件（要用router中的routes()方法）</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h2 id="🌵第四章-koa框架的控制器以及设计更合理的目录结构"><a href="#🌵第四章-koa框架的控制器以及设计更合理的目录结构" class="header-anchor">#</a> 🌵第四章：koa框架的控制器以及设计更合理的目录结构</h2> <h3 id="_1-控制器简介"><a href="#_1-控制器简介" class="header-anchor">#</a> 1.控制器简介</h3> <ul><li>什么是控制器？拿到路由分配的任务，并执行</li> <li>在Koa中，控制器是一个中间节</li> <li>为什么要用控制器
<ul><li>获取http请求参数</li> <li>处理业务逻辑（获取数据，处理数据，存储数据...）</li> <li>根据情况发送http响应</li></ul></li> <li>获取http请求参数
<ul><li>（查询字符串）Query String，例如 ?q=keyword</li> <li>（路由参数）Router Params，如 /users/:id （这个一般是必选的，而且可能有多个路由参数，我们公司也差不多是这样的）</li> <li>🔥（请求体）Body，如 { name: '朱昆鹏' }（一般用json）（From也是很常用的请求体）</li> <li>（请求头）Header，如 Accept,Cookie</li></ul></li></ul> <hr> <p><strong>🔥编写控制器最佳实践</strong></p> <ul><li>每个资源的控制器放到不同的文件夹下</li> <li>尽量使用类+类方法的形式编写控制器（我是一个接口就是一个函数，他这个的思想是，写成一个类，然后我的这些接口都是类方法，这样这些接口可以使用类的公共内容）</li> <li>严谨的错误处理</li></ul> <hr> <h3 id="_2-获取http请求参数"><a href="#_2-获取http请求参数" class="header-anchor">#</a> 2.获取http请求参数</h3> <ul><li>请求参数有：获取 query,获取 router params，获取 body, 获取 header</li> <li>通过断点调试，我发现 ctx 这个上下文上挂载的是我需要好好看看的各种东西，http参数都在这里面写着呢，名字也是通俗易懂</li> <li>🔥body这是个请求体，但是 koa是没有解析请求体的功能的（ctx上没有解析body的内容，ctx.body 是设置返回的，和这个没关系），需要加一个中间件</li> <li>安装解析请求体中间件：npm i koa-bodyparser --save</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bodyparser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span>
<span class="token comment">// ......</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyparser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 🔥使用：ctx.request.boay</span>
</code></pre></div><hr> <h3 id="_3-发送http响应"><a href="#_3-发送http响应" class="header-anchor">#</a> 3.发送HTTP响应</h3> <ul><li>如何发送status，body，header</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ......</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span> <span class="token comment">// 设置 status</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'...'</span> <span class="token comment">// 设置 body</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> <span class="token string">'GET,POST'</span><span class="token punctuation">)</span> <span class="token comment">// 设置响应头</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="🔥4-更合理的目录结构"><a href="#🔥4-更合理的目录结构" class="header-anchor">#</a> 🔥4.更合理的目录结构</h3> <ul><li>路由，控制器都放在一个目录里</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 🇨🇳 routes 文件夹 /users.js文件</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">;</span> <span class="token comment">// new Router({prefix:'user'}) 这样可以设置路由前缀，也是实用的</span>

<span class="token comment">// 查</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">// 一般返回数据列表</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router <span class="token comment">// 导出</span>


<span class="token comment">// 🇨🇳 写一个 routes/index.j 用来批量注册路由</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">===</span> <span class="token string">'index.js'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 🇨🇳 app.js 中使用批量注册</span>
<span class="token keyword">const</span> routing <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./app/routes'</span><span class="token punctuation">)</span>
<span class="token function">routing</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token comment">// 🇨🇳 建立 controllers 文件夹，在里面建立 users.js 🔥🔥🔥（这个定义类和使用类的方式，我喜欢，GET到了，确实比我写的Express正规）</span>
<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取用户列表</span>
  <span class="token function">getUsers</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'获取了用户列表'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 🇨🇳在路由中使用</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> getUsers <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/users'</span><span class="token punctuation">)</span> <span class="token comment">// 这是ES6语法，更简单</span>
<span class="token comment">// 获取所有列表</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">,</span> getUsers<span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router <span class="token comment">// 导出</span>
</code></pre></div><hr> <h2 id="🌱第五章-多种方案实现错误处理机制"><a href="#🌱第五章-多种方案实现错误处理机制" class="header-anchor">#</a> 🌱第五章：多种方案实现错误处理机制</h2> <h3 id="_1-错误处理简介"><a href="#_1-错误处理简介" class="header-anchor">#</a> 1.错误处理简介</h3> <ul><li>什么是错误处理？错误处理是编程语言或计算机硬件中的一种机制，用于处理软件或信息系统中出现的异常状况</li> <li>异常状况有哪些？
<ul><li>运行时错误：都返回500（代表服务器内部错误）</li> <li>逻辑错误：找不多（404），先决条件失败（412），无法处理的</li></ul></li> <li>为什么要用错误处理？
<ul><li>防止程序挂掉</li> <li>告诉用户错误信息</li></ul></li></ul> <hr> <h3 id="_2-koa自带的错误处理"><a href="#_2-koa自带的错误处理" class="header-anchor">#</a> 2.koa自带的错误处理</h3> <ul><li>如果请求的接口不存在的话，就会返回 404</li> <li>如果服务器内部语法错误，或者其他错误，就会返回 500</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 手动抛出</span>
ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'返回报错文本信息'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>❣️但是这里返回的都是文字，我们想返回JSON，这样才格式统一</strong></p> <hr> <h3 id="_3-自己编写错误处理中间件"><a href="#_3-自己编写错误处理中间件" class="header-anchor">#</a> 3.自己编写错误处理中间件</h3> <ul><li>写到所有中间件的最前面</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 原理就是捕捉下一个中间件的报错，然后返回状态码和内容（JSON格式）</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> err<span class="token punctuation">.</span>status <span class="token operator">||</span> err<span class="token punctuation">.</span>statusCode
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> err<span class="token punctuation">.</span>message
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="_4-使用-koa-json-error进行错误处理"><a href="#_4-使用-koa-json-error进行错误处理" class="header-anchor">#</a> 4.使用 koa-json-error进行错误处理</h3> <ul><li>安装：npm i koa-json-error --save</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-json-error'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 堆栈信息都返回了，这里可以配置</span>
<span class="token comment">// {</span>
<span class="token comment">//     &quot;message&quot;: &quot;Not Found&quot;,</span>
<span class="token comment">//     &quot;name&quot;: &quot;NotFoundError&quot;,</span>
<span class="token comment">//     &quot;stack&quot;: &quot;NotFoundError: Not Found\n    at Object.throw (/Users/zhukunpeng/Desktop/RESU ful API/node_modules/koa/lib/context.js:97:11)\n    at /Users/zhukunpeng/Desktop/RESU ful API/node_modules/koa-json-error/lib/middleware.js:52:58\n    at processTicksAndRejections (internal/process/task_queues.js:89:5)&quot;,</span>
<span class="token comment">//     &quot;status&quot;: 404</span>
<span class="token comment">// }</span>
</code></pre></div><p><strong>🔥设置环境变量，让我们在开发时候错误处理返回堆栈信息，生产环境不返回（未完成）</strong></p> <ul><li>安装：npm i cross-env --save-dev</li></ul> <hr> <h3 id="_5-使用koa-parameter进行参数校验"><a href="#_5-使用koa-parameter进行参数校验" class="header-anchor">#</a> 5.使用koa-parameter进行参数校验</h3> <ul><li>安装：npm i koa-parameter --save</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token comment">// 这个通常是校验请求体</span>
<span class="token keyword">const</span> parameter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-parameter'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">parameter</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 参数校验，加入app的话，就能在全局使用了</span>

<span class="token comment">// controller/users.js</span>

<span class="token comment">// 新建用户</span>
<span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  ctx<span class="token punctuation">.</span><span class="token function">verifyParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> user
<span class="token punctuation">}</span>

</code></pre></div><p><strong>如果错了的话</strong></p> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/10.png"> <p><strong>还有更多的限制条件，例如必选，例如什么类型，这个都可以查阅</strong></p> <hr> <h2 id="🌿第六章-koa-mongodb-实现增删改查"><a href="#🌿第六章-koa-mongodb-实现增删改查" class="header-anchor">#</a> 🌿第六章：koa + MongoDB 实现增删改查</h2> <h3 id="_1-nosql简介"><a href="#_1-nosql简介" class="header-anchor">#</a> 1.NoSQL简介</h3> <ul><li>不属于关系型数据库的哪一类 被称为 NoSQL</li> <li>NoSQL数据库的分类
<ul><li>列存储（HBase）</li> <li>🔥文档存储（MongoDB）（所谓文档存储就是按照JSON存储）</li> <li>key-value 存储（Redis）(通常用于缓存和消息通信)</li> <li>......</li></ul></li> <li>为什么要用 NoSQL
<ul><li>简单（没有原子性，一致性，隔离性等复杂规范）（关系型数据库要多个机器协同工作，必须要符合这些规范，这样就增加了很多通信）</li> <li>便于横向拓展（因为简单，没有规范，所以便于拓展）</li> <li>适合超大规模的数据存储（还是因为拓展）</li> <li>很灵活的存储复杂结构的数据</li></ul></li></ul> <hr> <h3 id="🔥2-mongoose-连接-mongodb"><a href="#🔥2-mongoose-连接-mongodb" class="header-anchor">#</a> 🔥2.mongoose 连接 MongoDB</h3> <ul><li>安装：npm install mongoose --save</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

<span class="token comment">// 使用</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://47.95.0.108:27017/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'连接成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><hr> <h3 id="_3-设计用户模块的schema"><a href="#_3-设计用户模块的schema" class="header-anchor">#</a> 3.设计用户模块的Schema</h3> <ul><li>这里的Schema是JSON的，写完之后，我们生成一个 Model</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 我们在 /app/model/users.js 建立一个model文件夹，在里面建立users.js</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> model <span class="token punctuation">}</span> <span class="token operator">=</span> mongoose<span class="token punctuation">;</span>

<span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 第一个表示是字符串这没啥，第二个意思是必写项,当然还有很多设置，例如 default: ** 这是设置默认值的，当用户没传的时候，这个就生效，更多请看百度</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 前面User会在MongoDB里面建立一个集合</span>
</code></pre></div><hr> <h3 id="🔥4-mongodb实现用户的增删改查"><a href="#🔥4-mongodb实现用户的增删改查" class="header-anchor">#</a> 🔥4.MongoDB实现用户的增删改查</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../model/users'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">UsersCtl</span> <span class="token punctuation">{</span>

  <span class="token comment">// 查询所有用户（find里面也能传正则哦）</span>
  <span class="token keyword">async</span> <span class="token function">findUser</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>

  <span class="token comment">// 根据ID查询特定用户（findById）</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'用户不存在'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> user
  <span class="token punctuation">}</span>

  <span class="token comment">// 新建用户（new + save()）</span>
  <span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 这里有两个细节，一个是需要 new，另一个是需要 .save()</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> user
  <span class="token punctuation">}</span>

  <span class="token comment">// 修改（findByIdAndUpdate）</span>
  <span class="token keyword">async</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'用户不存在'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> user <span class="token comment">// 注意：这里修改的是返回之前的信息</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 删除（findByIdAndRemove）</span>
  <span class="token keyword">async</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'用户不存在'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">204</span> <span class="token comment">// RESUful API 规范</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsersCtl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h2 id="🎋第七章-jwt在koa框架中实现用户的认证与授权"><a href="#🎋第七章-jwt在koa框架中实现用户的认证与授权" class="header-anchor">#</a> 🎋第七章：JWT在Koa框架中实现用户的认证与授权</h2> <h3 id="_1-session简介"><a href="#_1-session简介" class="header-anchor">#</a> 1.session简介</h3> <ul><li>session是一种非常重要，常见的，用户认证与授权</li></ul> <p><strong>session工作原理</strong></p> <ul><li>先登录，然后后端返回一个session id，然后前端再请求非登录的一些信息的时候都需要带上这个，否者报错</li></ul> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/3.png"> <ul><li>session的优势
<ul><li>相比 JWT，最大的优势就在于可以主动清除session</li> <li>session保存在服务器端，相对较为安全</li> <li>结合 cookie 使用，较为灵活，兼容性较好</li></ul></li> <li>session的劣势
<ul><li>cookie + session 在跨域场景下表现并不好</li> <li>如果是分布式部署，需要做多机共享session机制 🔥</li> <li>基于cookie的机制很容易被CSRF</li> <li>查询 session 信息可能会有数据库查询操作</li></ul></li> <li>session相关概念介绍
<ul><li>主要放到服务器端，相对于安全</li> <li>cookie 主要放到客户端，并不是很安全</li> <li>sessionStronge：仅在当前会话下有效，关闭页面或者浏览器后被清除</li> <li>localstorage：除非被清除，否者永久保存</li></ul></li></ul> <hr> <h3 id="_2-jwt简介"><a href="#_2-jwt简介" class="header-anchor">#</a> 2.JWT简介</h3> <ul><li>什么是JWT？（JSON Web Token 是一个开放标准（RFC 7519））</li> <li>定义了一种紧凑且独立的方式，可以将各方之间的信息作为JSON对象进行安全传输</li> <li>该信息可以验证和信任，因为是经过数字签名的</li> <li>JWT的构成：头部（Header）, 有效载荷（Payload）,签名（Signature）</li></ul> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/4.png"> <p><strong>有效载荷介绍（这个挺重要的）</strong></p> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/5.png"> <p><strong>JWT原理</strong></p> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/6.png"> <hr> <h3 id="_3-jwt-vs-session"><a href="#_3-jwt-vs-session" class="header-anchor">#</a> 3. JWT vs session</h3> <ul><li>可拓展性
<ul><li>session 一般都是存到 redis 这种数据库中，你可以需要做一个中心式的session存储系统才行，否则没办法共享</li> <li>基于 token 基于 令牌的这种方式是无状态的，我们可以轻松的拓展（听着怎么感觉这个很溜 🔥）</li></ul></li> <li>安全性（...讲了四个，有空看下吧）</li> <li>RESTful API（要求是无状态的，这就用JWT）</li> <li>性能（各有利弊）
<ul><li>JWT可能性能不好，因为 session 更小</li> <li>session 毕竟放到客户端的是一段 id，传到服务器端，服务器端还要根据这个id拿真正的 session 数据，也是有性能消耗的</li></ul></li> <li>时效性
<ul><li>JWT 必须等到过期才更新，不能主动销毁</li> <li>session 可以主动销毁</li></ul></li></ul> <hr> <h3 id="_4-在-node-js-中使用-jwt"><a href="#_4-在-node-js-中使用-jwt" class="header-anchor">#</a> 4.在 Node.js 中使用 JWT</h3> <ul><li>安装：npm i jsonwebtoken</li> <li>签名：</li> <li>逆向验证：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 签名（参数一，就是传过来的参数，参数二 是秘钥）</span>
token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'zhu'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token comment">// 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemh1IiwiaWF0IjoxNTYxNzI0NTUzfQ.-JVehTSs3neUbRzF__9lTsXEul_rvA5WYNbpx702Eo4'</span>

<span class="token comment">// 验证（参数一，前端传过来的token，参数二 秘钥）</span>
jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="_5-实现用户注册"><a href="#_5-实现用户注册" class="header-anchor">#</a> 5.实现用户注册</h3> <ul><li>设计用户 Schema</li> <li>编写保证唯一性的逻辑</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 设计用户 Schema</span>
<span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 这个是自动生成的，但是每次都返回不好，所以我们这里给他设置下，让它不返回</span>
    __v<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> Number<span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 第一个表示是字符串这没啥，第二个意思是必写项</span>
    <span class="token comment">// select 的意思是不返回，这是密码，如果能被请求到，那是不是很恐怖🙀</span>
    password<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 新建用户（有个查询用户名是否重复）</span>
<span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
  <span class="token keyword">const</span> repeatedUser <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查询是否有这个用户了</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>repeatedUser<span class="token punctuation">)</span> ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">,</span> <span class="token string">'用户已经存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> user
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="_6-实现登录并获取-token"><a href="#_6-实现登录并获取-token" class="header-anchor">#</a> 6.实现登录并获取 Token</h3> <ul><li>登录接口的设计（因为它不属于用户增删改查中的一种）</li> <li>使用 jsonwebtoken 生成 token</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 登录</span>
<span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 校验用户名和密码</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">'用户名或者密码不正确'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token comment">// 登录正确，生成token</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> _id<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> user<span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> josnwebtoken<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>expiresIn<span class="token operator">:</span> <span class="token string">'1d'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 参数一 账号密码，参数二 秘钥，参数三 配置，这里配置的是过期时间 1d 1天</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="_7-自己编写中间件实现用户的认证和授权"><a href="#_7-自己编写中间件实现用户的认证和授权" class="header-anchor">#</a> 7.自己编写中间件实现用户的认证和授权</h3> <hr> <h3 id="_8-用koa-jwt中间件实现用户的认证和授权"><a href="#_8-用koa-jwt中间件实现用户的认证和授权" class="header-anchor">#</a> 8.用koa-jwt中间件实现用户的认证和授权</h3> <ul><li>安装：npm i koa-jwt --save</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在路由 /routes/users.js</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-jwt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">jwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> secret<span class="token operator">:</span> <span class="token string">'zhukunpeng'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 传入秘钥</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> checkOwner<span class="token punctuation">,</span> findUserId<span class="token punctuation">)</span> <span class="token comment">// 根据ID 查询特定用户 数据</span>

<span class="token comment">// /controller/users.js</span>
<span class="token comment">// 权限校验</span>
<span class="token keyword">async</span> <span class="token function">checkOwner</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id <span class="token operator">!==</span> ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token string">'没有权限查看'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/7.png"> <hr> <h2 id="🐲第八章-上传图片模块"><a href="#🐲第八章-上传图片模块" class="header-anchor">#</a> 🐲第八章：上传图片模块</h2> <h3 id="_1-上传图片需求分析"><a href="#_1-上传图片需求分析" class="header-anchor">#</a> 1.上传图片需求分析</h3> <ul><li>用户头像</li> <li>封面图片</li> <li>问题和回答中的图片</li> <li>话题图片</li></ul> <hr> <ul><li>基础功能：上传图片，生成图片链接</li> <li>附加功能：限制上传图片的大小和类型，生成高中低三种分辨率的图片链接，生成CDN</li> <li>上传图片的技术方案
<ul><li>阿里云OSS等云服务，推荐生成环境下使用</li> <li>直接上传到服务器，不推荐在生产环境下使用，因为不稳定</li></ul></li></ul> <hr> <h3 id="_2-使用-koa-body-中间件获取上传的文件"><a href="#_2-使用-koa-body-中间件获取上传的文件" class="header-anchor">#</a> 2.使用 koa-body 中间件获取上传的文件</h3> <ul><li>之前我们用的是 koa-bodyparser ，但是这个不支持文件，只支持 JSON 和... ，所以我们用 koa-body 这个中间件</li> <li>安装：npm i koa-body  --save</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js &amp;&amp; 建立 public/uploads 用来盛放上传文件</span>
<span class="token keyword">const</span> bodyBody <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-body'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyBody</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    multipart<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用文件传输</span>
    formidable<span class="token operator">:</span> <span class="token punctuation">{</span>
        uploadDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'app/public/uploads'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 文件上传路径</span>
        keepExtensions<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 保留拓展名</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解析 请求body中的 JSON</span>

<span class="token comment">// 建立 controller/home.js</span>
<span class="token keyword">class</span> <span class="token class-name">HomeCtl</span> <span class="token punctuation">{</span>

    <span class="token comment">// 上传文件</span>
    <span class="token function">upload</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> file <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>files<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
          message<span class="token operator">:</span> <span class="token string">'上传成功'</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HomeCtl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 建立 router/home.js</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">;</span> <span class="token comment">// new Router({prefix:'user'}) 这样可以设置路由前缀，也是实用的</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> upload <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> upload<span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router

</code></pre></div><hr> <h3 id="_3-使用-koa-static-中间件生成图片链接"><a href="#_3-使用-koa-static-中间件生成图片链接" class="header-anchor">#</a> 3.使用 koa-static 中间件生成图片链接</h3> <ul><li>安装：npm i koa-static --save</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> koaStatic <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">koaStatic</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'app/public/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 生成上传图片链接，这里还启动了静态服务，直接代理我们设置的文件路径</span>


<span class="token comment">// controller/home.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">HomeCtl</span> <span class="token punctuation">{</span>
    <span class="token comment">// 上传文件</span>
    <span class="token function">upload</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> file <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>file<span class="token punctuation">;</span>
        <span class="token keyword">const</span> basename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/uploads/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>basename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HomeCtl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><hr> <h3 id="_4-编写前端页面上传文件"><a href="#_4-编写前端页面上传文件" class="header-anchor">#</a> 4.编写前端页面上传文件</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:3000/upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>返回结果</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000/uploads/upload_34ca030139713427223a1c8b604b603a.jpg&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="🍀第九章-个人资料模块"><a href="#🍀第九章-个人资料模块" class="header-anchor">#</a> 🍀第九章：个人资料模块</h2> <hr> <h3 id="_1-个人资料的-schema-设计"><a href="#_1-个人资料的-schema-设计" class="header-anchor">#</a> 1.个人资料的 schema 设计</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// module/users.js</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> model <span class="token punctuation">}</span> <span class="token operator">=</span> mongoose<span class="token punctuation">;</span>

<span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    __v<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> Number<span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 第一个表示是字符串这没啥，第二个意思是必写项</span>
    password<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    avatar_url<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 头像的URL</span>
    gender<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token string">'famale'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'male'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 性别，这里后面 enum 是mongoose的可枚举类型，枚举的值是那两个, 后面的是默认值 male</span>
    handline<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 一句话介绍</span>
    loacations<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 居住地，类型是字符串数组</span>
    employments<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 职业经历</span>
        type<span class="token operator">:</span> <span class="token punctuation">{</span>
            company<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 公司</span>
            job<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span> <span class="token comment">// 职位</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 前面User会在MongoDB里面建立一个集合</span>

</code></pre></div><hr> <h3 id="_2-个人资料的参数校验"><a href="#_2-个人资料的参数校验" class="header-anchor">#</a> 2.个人资料的参数校验</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 还是有一些和 mongoose 不一样的地方，这里要注意</span>
ctx<span class="token punctuation">.</span><span class="token function">verifyParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  avatar_url<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// required: false表示非必选</span>
  gender<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  handline<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  loacations<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'array'</span><span class="token punctuation">,</span> itemType<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// itemType这是表示数组里面的项是字符串类型，这和mongoose不一样</span>
  employments<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span><span class="token string">'array'</span><span class="token punctuation">,</span> itemType<span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="🔥3-restful-api-最佳实践-字段过滤"><a href="#🔥3-restful-api-最佳实践-字段过滤" class="header-anchor">#</a> 🔥3.RESTful API 最佳实践 - 字段过滤</h3> <ul><li>有哪些字段显示，哪些字段不显示，有种GrhpQL的感觉</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过 select: false 我们可以隐藏一些返回字段</span>
<span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    __v<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> Number<span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 第一个表示是字符串这没啥，第二个意思是必写项</span>
    password<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    avatar_url<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 头像的URL</span>
    gender<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token string">'famale'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'male'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 性别，这里后面 enum 是mongoose的可枚举类型，枚举的值是那两个, 后面的是默认值 male</span>
    handline<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 一句话介绍</span>
    loacations<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>type<span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 居住地，类型是字符串数组</span>
    employments<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 职业经历</span>
        type<span class="token operator">:</span> <span class="token punctuation">{</span>
            company<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 公司</span>
            job<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span> <span class="token comment">// 职位</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        select<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// /controller/users.js（主要就是借助mongoose 的 select方法，拼接成 +...+...这种形式）</span>

<span class="token comment">// 问题就是 现在一个可以，但是两个就不行了</span>

<span class="token comment">// 查询用户</span>
<span class="token keyword">async</span> <span class="token function">findUser</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fields <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query<span class="token punctuation">;</span> <span class="token comment">// 这是以分号隔开的</span>
  <span class="token keyword">let</span> selectFidlds <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// 将分号隔开的转为 +...+ 这种形式</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fields<span class="token punctuation">)</span> selectFidlds <span class="token operator">=</span> fields<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token string">'+'</span> <span class="token operator">+</span> f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selectFidlds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h2 id="🌳第十章-关注与粉丝模块"><a href="#🌳第十章-关注与粉丝模块" class="header-anchor">#</a> 🌳第十章：关注与粉丝模块</h2> <h3 id="_1-关注与粉丝的-schema-设计"><a href="#_1-关注与粉丝的-schema-设计" class="header-anchor">#</a> 1.关注与粉丝的 schema 设计</h3> <p><strong>功能点</strong></p> <ul><li>关注，取消关注</li> <li>获取关注人，粉丝列表（用户-用户 多对多关系）</li></ul> <hr> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ......</span>
  following<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 关注</span>
      type<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> ref<span class="token operator">:</span> <span class="token string">'User'</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 非常好的一个技巧，但是我不太懂</span>
      select<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><hr> <h3 id="_2-restful-api-风格的关注与粉丝接口"><a href="#_2-restful-api-风格的关注与粉丝接口" class="header-anchor">#</a> 2.RESTful API 风格的关注与粉丝接口</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// controller/users.js</span>
<span class="token comment">// 获取用户的关注者</span>
<span class="token keyword">async</span> <span class="token function">listFollowing</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'+following'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'+following'</span><span class="token punctuation">)</span>
  <span class="token comment">// 获取的关注者是用户的ID，我们正常来说需要遍历这个ID，才能拿到每个关注者的头像和其他信息</span>
  <span class="token comment">// 但是 model/users.js 里面的结构那么写，让我们可以使用 populate() 这个快捷方法了</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'用户不存在'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> user<span class="token punctuation">.</span>following
<span class="token punctuation">}</span>
<span class="token comment">// 用户-关注用户</span>
<span class="token keyword">async</span> <span class="token function">follow</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> me <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'+following'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>me<span class="token punctuation">.</span>following<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    me<span class="token punctuation">.</span>following<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token comment">// 把数组放到的ID放到里面</span>
    me<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">204</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用户-取消关注</span>
<span class="token keyword">async</span> <span class="token function">unfollow</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> me <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'+following'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> index <span class="token operator">=</span> me<span class="token punctuation">.</span>following<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    me<span class="token punctuation">.</span>following<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    me<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">204</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用户-获取粉丝</span>
<span class="token keyword">async</span> <span class="token function">listFollowers</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>following<span class="token operator">:</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> users
<span class="token punctuation">}</span>


<span class="token comment">// routes/users.js</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id/following'</span><span class="token punctuation">,</span> listFollowing<span class="token punctuation">)</span> <span class="token comment">// 获取某个用户 关注了谁</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id/followers'</span><span class="token punctuation">,</span> listFollowers<span class="token punctuation">)</span> <span class="token comment">// 获取某个用户 关注了谁</span>
router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/user/following/:id'</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> follow<span class="token punctuation">)</span> <span class="token comment">// 用户-关注用户</span>
router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/user/following/:id'</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> unfollow<span class="token punctuation">)</span> <span class="token comment">// 用户-取消关注</span>
</code></pre></div><hr> <h3 id="_3-编写校验用户存在与否的中间件"><a href="#_3-编写校验用户存在与否的中间件" class="header-anchor">#</a> 3.编写校验用户存在与否的中间件</h3> <p><strong>在关注，和取消关注之前，校验一下用户存在与否</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// controller/users.js</span>
<span class="token comment">// 检测用户是否存在（中间件）</span>
<span class="token keyword">async</span> <span class="token function">checkUserExist</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'用户不存在'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// routes/users.js（添加）</span>
router<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/user/following/:id'</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> checkUserExist<span class="token punctuation">,</span> follow<span class="token punctuation">)</span> <span class="token comment">// 用户-关注用户</span>
router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/user/following/:id'</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> checkUserExist<span class="token punctuation">,</span> unfollow<span class="token punctuation">)</span> <span class="token comment">// 用户-取消关注</span>
</code></pre></div><hr> <h2 id="🌴第十一章-话题模块"><a href="#🌴第十一章-话题模块" class="header-anchor">#</a> 🌴第十一章：话题模块</h2> <h3 id="_1-话题增改查接口"><a href="#_1-话题增改查接口" class="header-anchor">#</a> 1.话题增改查接口</h3> <p><strong>功能模块功能点</strong></p> <ul><li>话题的增改查（没有删，因为话题关联太多）</li> <li>分页，模糊查询</li> <li>用户属性中的话题引用</li> <li>关注/取消关注话题，用户关注的话题列表</li></ul> <p><strong>设计Schema</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建立新文件 modle/topics.js</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> model <span class="token punctuation">}</span> <span class="token operator">=</span> mongoose<span class="token punctuation">;</span>

<span class="token keyword">const</span> topicSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    __v<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> Number<span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 话题名称</span>
    avatar_url<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 话题图片</span>
    introduction<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 话题简介</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Topic'</span><span class="token punctuation">,</span> topicSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>写Controller</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建立新文件 controller/topics.js</span>
<span class="token keyword">const</span> Topic <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../model/topics'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TopicsCtl</span> <span class="token punctuation">{</span>
   
    <span class="token comment">// 获取话题列表</span>
    <span class="token keyword">async</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> Topic<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 查询特定话题</span>
    <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// const { fields } = ctx.query</span>
        <span class="token comment">// const selectFields = fields.split(';').filter(f =&gt; f).map(f =&gt; ' +' + f).join('')</span>
        <span class="token comment">// const topic = await Topic.findById(ctx.params.id).select(selectFields)</span>
        <span class="token keyword">const</span> topic <span class="token operator">=</span> <span class="token keyword">await</span> Topic<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> topic
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建话题</span>
    <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">verifyParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            avatar_url<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            introduction<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> topic <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Topic</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> topic
    <span class="token punctuation">}</span>

    <span class="token comment">// 修改话题</span>
    <span class="token keyword">async</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">verifyParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            avatar_url<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            introduction<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> topic <span class="token operator">=</span> <span class="token keyword">await</span> Topic<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> topic
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TopicsCtl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>写Routes</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建立文件 routes/topics.js</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">;</span> <span class="token comment">// new Router({prefix:'user'}) 这样可以设置路由前缀，也是实用的</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> find<span class="token punctuation">,</span> findById<span class="token punctuation">,</span> create<span class="token punctuation">,</span> update <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/topics'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-jwt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">jwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> secret<span class="token operator">:</span> <span class="token string">'zhukunpeng'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 传入秘钥</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/topics'</span><span class="token punctuation">,</span> find<span class="token punctuation">)</span> <span class="token comment">// 查询所有话题</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/topics'</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> create<span class="token punctuation">)</span> <span class="token comment">// 创建话题</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/topics/:id'</span><span class="token punctuation">,</span> findById<span class="token punctuation">)</span> <span class="token comment">// 获取特定话题</span>
router<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string">'/topics/:id'</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> update<span class="token punctuation">)</span> <span class="token comment">// 修改特定话题</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre></div><hr> <h3 id="🔥2-分页实现"><a href="#🔥2-分页实现" class="header-anchor">#</a> 🔥2.分页实现</h3> <p><strong>根据查询字符串来限制列表的返回值</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 获取话题列表 的分页逻辑（主要是算法）</span>
<span class="token keyword">async</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> per_page <span class="token operator">=</span> <span class="token number">10</span> <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query
    <span class="token keyword">const</span> page <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>page <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// 当前是第几页</span>
    <span class="token keyword">const</span> perPage <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>per_page <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 每页显示几条</span>
    <span class="token comment">// mongoose limit() 可以获取几个，skip() 可以从第几个开始，虽然没有 limit(x, y) 这种好，但是也行</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> Topic<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>perPage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>page <span class="token operator">*</span> perPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 示例：http://localhost:3000/topics?page=1&amp;per_page=2</span>
</code></pre></div><hr> <h3 id="🔥3-模糊搜索-关键词搜索"><a href="#🔥3-模糊搜索-关键词搜索" class="header-anchor">#</a> 🔥3.模糊搜索（关键词搜索）</h3> <p><strong>借助mongoose语法糖，一行代码就能实现：在find() 里面写正则</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ......</span>
ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> Topic
    <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>q<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>perPage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>page <span class="token operator">*</span> perPage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mongoose使用多个字段的模糊</span>
<span class="token comment">// .find({ $or: [{name: ...}, {...}] })</span>
</code></pre></div><hr> <h3 id="❣️4-用户属性中的话题引用"><a href="#❣️4-用户属性中的话题引用" class="header-anchor">#</a> ❣️4.用户属性中的话题引用</h3> <p><strong>没太懂，但是这里 type: Schema.Types.ObjectId, ref: 'Topic' 方法是一种引用，类似于MySQL的外链，多表查询用的那种</strong></p> <hr> <h3 id="_5-关注话题接口-略"><a href="#_5-关注话题接口-略" class="header-anchor">#</a> 5.关注话题接口（略...）</h3> <hr> <h2 id="🌱第十二章-问题模块"><a href="#🌱第十二章-问题模块" class="header-anchor">#</a> 🌱第十二章：问题模块</h2> <h3 id="_1-问题的增删改查-用户的问题列表-用户-问题-一对多关系"><a href="#_1-问题的增删改查-用户的问题列表-用户-问题-一对多关系" class="header-anchor">#</a> 1.问题的增删改查，用户的问题列表（用户-问题 一对多关系）</h3> <p>一个用户可以提多个问题，但是一个问题只属于一个用户</p> <p><strong>建立 Schema</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> model <span class="token punctuation">}</span> <span class="token operator">=</span> mongoose<span class="token punctuation">;</span>

<span class="token keyword">const</span> questionSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    __v<span class="token operator">:</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> Number<span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 问题标题</span>
    description<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 描述</span>
    questioner<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> ref<span class="token operator">:</span> <span class="token string">'User'</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 提问者，这个设计是实现 一对多的核心</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Question'</span><span class="token punctuation">,</span> questionSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>实现 Controller</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div><p><strong>❣️这里我突然有一个想法，就是 可以抽象出一个基本类，上面挂载分页方法，模糊查询方法等，甚至增删改查接口也能抽离成公共的，下面的类谁想用了，就直接用继承，然后使用了</strong></p> <hr> <h3 id="_2-话题-问题-多对多关系"><a href="#_2-话题-问题-多对多关系" class="header-anchor">#</a> 2.话题-问题 多对多关系</h3> <ul><li>思路：两个列表，就是这两个列表都能成为对方的列表</li></ul> <hr> <h2 id="🌿第十三章-答案模块"><a href="#🌿第十三章-答案模块" class="header-anchor">#</a> 🌿第十三章：答案模块</h2> <h3 id="_1-答案模块二级嵌套的增删改查接口"><a href="#_1-答案模块二级嵌套的增删改查接口" class="header-anchor">#</a> 1.答案模块二级嵌套的增删改查接口</h3> <hr> <h2 id="🌾第十四章-评论模块"><a href="#🌾第十四章-评论模块" class="header-anchor">#</a> 🌾第十四章：评论模块</h2> <hr> <h2 id="🌿第十五章-项目上线-部署"><a href="#🌿第十五章-项目上线-部署" class="header-anchor">#</a> 🌿第十五章：项目上线，部署</h2> <h3 id="_1-用nginx实现端口转发"><a href="#_1-用nginx实现端口转发" class="header-anchor">#</a> 1.用NGINX实现端口转发</h3> <p><strong>一般服务器很多端口都没开，一般80端口开了，NGINX 就可以代理80端口，然后访问到内网的具体端口上</strong></p> <ul><li>语法检查：nginx -t（主要修改nginx.conf）</li> <li>重启：service nginx restart</li></ul> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/8.png"> <p><strong>Postman生成文档</strong></p> <ul><li>还是很漂亮的</li></ul> <img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.note/5.%E5%85%B6%E4%BB%96%E9%9B%B6%E6%95%A3%E7%AC%94%E8%AE%B0/%E6%85%95%E8%AF%BE%E7%BD%91%E8%AF%BE%E7%A8%8BRESTful%20API/9.png"> <hr> <h2 id="📚参考列表-最后更新2019-6-23-23-23"><a href="#📚参考列表-最后更新2019-6-23-23-23" class="header-anchor">#</a> 📚参考列表（最后更新2019.6.23 23:23）</h2> <ul><li><a href="https://coding.imooc.com/learn/list/354.html" target="_blank" rel="noopener noreferrer">慕课网课程-Node.js开发仿知乎服务端 深入理解RESTful API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/2.note/8.6前端架构/2.前端国际化方案（Vue项目）.html" class="prev">
        2.前端国际化方案（Vue项目）
      </a></span> <span class="next"><a href="/2.note/9.项目/2.行为封装软件.html">
        2.软件开发行为封装软件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a28e9894.js" defer></script><script src="/assets/js/2.b5be6ff6.js" defer></script><script src="/assets/js/99.ec48a5d6.js" defer></script><script src="/assets/js/3.87d40112.js" defer></script>
  </body>
</html>

# 4.ES6

::: warning
æ³¨æ„æ­¤å¤„ï¼šå†…å®¹ä¸å…¨ï¼Œç»“æ„æ··ä¹±ï¼Œç­‰å¾…é‡æ„...
:::

---

## ES6

### 0.ES6æ¨¡å—åŒ–


```html
<!-- åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ES6æ¨¡å—ï¼šæ¨¡å—ä½œç”¨åŸŸï¼Œè‡ªåŠ¨ä¸¥æ ¼æ¨¡å¼ -->
<script type="module"></script>
```

**æ¨¡å—çš„å¯¼å…¥å’Œå¯¼å‡º**

```js
// å¯¼å‡º a.js
let a = 10;
let b = 20;
// export c = 30; å®šä¹‰æ—¶å¯¼å‡º

export default {
  a,
  b
}


// å¯¼å…¥ a.js
import { a, b } from './a.js'
console.log(a) // 10
console.log(b) // 20

import * as m from './a.js' // å…¨éƒ¨å¼•å…¥
// Module {
//   default: Object,
//   Symbol(Symbol.toStringTag): "Module"
// }

import('./a.js').then( m => {console.log('m', m)}) // å¼‚æ­¥å¼•å…¥
// Module {
//   default: Object,
//   Symbol(Symbol.toStringTag): "Module"
// }

```

---

### 1.åŸºç¡€ï¼ˆå®šä¹‰å˜é‡ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²ï¼‰

**å®šä¹‰å˜é‡çš„æ–°æ–¹å¼**

- letå…³é”®å­—
  - å—çº§ä½œç”¨åŸŸ
  - å˜é‡æå‡ï¼Œæš‚æ—¶æ€§æ­»åŒº
  - ä¸å…è®¸é‡å¤å£°æ˜
- constå…³é”®å­—ï¼ˆå®šä¹‰å¸¸é‡ï¼‰
  - ç±»ä¼¼äºlet
  - ä¸å…è®¸é‡å¤èµ‹å€¼

---

**let å’Œ const åˆ°åº•æœ‰æ²¡æœ‰å˜é‡æå‡ï¼Ÿæœ‰çš„è¯ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åœ¨å®šä¹‰å‰ä½¿ç”¨ï¼Ÿ**

- var çš„ã€Œåˆ›å»ºã€å’Œã€Œåˆå§‹åŒ–ã€éƒ½è¢«æå‡äº†
- function çš„ã€Œåˆ›å»ºã€ã€Œåˆå§‹åŒ–ã€å’Œã€Œèµ‹å€¼ã€éƒ½è¢«æå‡äº†
- let çš„ã€Œåˆ›å»ºã€è¿‡ç¨‹è¢«æå‡äº†ï¼Œä½†æ˜¯åˆå§‹åŒ–æ²¡æœ‰æå‡
- const åªæœ‰ã€Œåˆ›å»ºã€å’Œã€Œåˆå§‹åŒ–ã€ï¼Œæ²¡æœ‰ã€Œèµ‹å€¼ã€è¿‡ç¨‹

<img src="https://pic1.zhimg.com/80/v2-9c8c4a0a3ce5402b1a74f488d79c74d0_hd.jpg" />

[åŸæ–‡é“¾æ¥](https://zhuanlan.zhihu.com/p/28140450)

---

**æ¨¡æ¿å­—ç¬¦ä¸²**

```js

// å®ç°è¿™ä¸ªæ•ˆæœ
// ä½ å¥½ä¸–ç•Œ!
// æ—©ä¸Šå¥½

// ES5
let str = 'ä¸–ç•Œ'
let str = 'ä½ å¥½' + str + '!\n' + 'æ—©ä¸Šå¥½'

// ES6
let strEs6 = `
ä½ å¥½${str}!
æ—©ä¸Šå¥½
`

```

---

### 2.æ•°ç»„æ‹“å±•

**æ‹“å±•è¿ç®—ç¬¦**

```js
// æ±‚æ•°ç»„è¿™é‡Œé¢æœ€å¤§çš„å€¼
let arr = [1,2,34,5,6,9]

// åŸç”ŸAPI Math.max(1,2,34,5,6,9) æ¥æ”¶çš„æ˜¯ä¸€ç»„æ•°ï¼Œæ‰€ä»¥è¿˜éœ€è¦è½¬ä¸€ä¸‹
Math.max.apply(null, arr) //ES5 34
Math.max(...arr) // ES6 34

```

**â£ï¸æ³¨æ„ï¼šæ•°ç»„çš„æ‹“å±•è¿ç®—ç¬¦æ˜¯æµ…æ‹·è´**

---

**è§£æ„èµ‹å€¼ï¼šæœ¬è´¨æ˜¯æ¨¡å¼åŒ¹é…**

```js

let arr = [1,2,3]
let { x, y, z } = arr
x // 1
y // 2
z // 3

```

---

**ES6æ–°å¢çš„é™æ€æ–¹æ³•ï¼šArray.from() && Array.of()**

```js
// Array.from() å°†ç±»æ•°ç»„æˆ–è€…å…·æœ‰è¿­ä»£å™¨æ¥å£çš„ è½¬ä¸º çœŸæ­£æ•°ç»„
Array.from(arguments)

// Array.of() ä¼ å…¥å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼ˆå¯¹æ ‡ new Array() åˆ›å»ºä¸€ä¸ªæ—¶å€™æœ‰é—®é¢˜çš„ï¼Œç”¨ofæ›´è§„èŒƒï¼‰
Array.of(13) // [13]
Array.of(13, 14) // [13, 14]

new Array(13) // ä¼šåˆ›å»ºä¸€ä¸ªé•¿åº¦ 13çš„æ•°ç»„
new Array(13, 14) // [13, 14]
```

---

**ES6æ–°å¢åŸå‹ä¸Šçš„æ–¹æ³•ï¼š**

- Array.prototype.find() æ‰¾æ•°ç»„ä¸­æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„å†…å®¹ï¼Œè¿”å› true/false
- Array.prototype.findIndex() æ‰¾æ•°ç»„ä¸­æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„å†…å®¹ï¼Œè¿”å› åæ ‡/-1
- Array.prototype.includes() æ‰¾æ•°ç»„ä¸­æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„å†…å®¹ï¼ˆâ£ï¸å’Œfindä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™ä¸ªå†…éƒ¨åˆ¤æ–­ä¾æ®æ˜¯ ==ï¼Œè€Œ findåˆ¤æ–­ä¾æ®æ˜¯ ===ï¼‰
  - ä¹Ÿå°±æ˜¯è¿™ä¸ªå¯ä»¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ NaN
- Array.prototype.fill() ä¼ å…¥ä¸€ä¸ªæ•°ï¼Œè¿™ä¸ªæ•°ç»„æ¯ä¸€é¡¹ éƒ½ä¼šå˜æˆè¿™ä¸ªæ•°
- Array.prototype.flat() é™çº¬æ•°ç»„ï¼Œå‚æ•°å¦‚æœæ˜¯Infinityå¯ä»¥æŠŠä»»æ„çº¬åº¦ï¼Œé™åˆ°ä¸€ç»´
- Array.prototype.

```js

// åšä¸ªé¢˜å§ [1,2,3] å˜æˆ [1,0,2,0,0,3,0,0,0] ï¼ˆ1åé¢åŠ ä¸Š1ä¸ª0ï¼Œ2åé¢åŠ ä¸Š2ä¸ª0ï¼Œ3åé¢åŠ ä¸Š3ä¸ª0ï¼‰
let arr = [1,2,3]
arr.map( item => [item, ...new Array(item).fill(0)]).flat() // Â [1, 0, 2, 0, 0, 3, 0, 0, 0]

```

---

### 3.è§£æ„èµ‹å€¼è¯¦è§£

æˆ‘çœ‹ç€è¿™ä¸ªåŠŸèƒ½ï¼Œçœ‹ä¸åˆ°åº•å±‚ï¼Œåªèƒ½çœ‹è¿™ä¸ªçš„è§„åˆ™

```js

// ç»“æ„å¯¹è±¡
let obj = {
  name: 'æœ±æ˜†é¹',
  age: 21
}

{ name, age } = obj // name = 'æœ±æ˜†é¹', age = 20
{ name: onName, age: onAge } = obj // onName = 'æœ±æ˜†é¹', onAge = 20
{ name: onName, age: onAge, sex = 'man' } = obj // onName = 'æœ±æ˜†é¹', onAge = 20, sex = 'man'


// è§£æ„æ•°ç»„
let arr = [1, 2, 3]
{x , y, z} = arr // undefined
{0: x , 1: y, 2: z} = arr // x = 1, y = 2, z = 3
[x, y, z] = arr // x = 1, y = 2, z = 3
{ length } = arr // length = 3

```

---

**â£ï¸æœ¬è´¨ä¸Šæ˜¯æ¨¡å¼åŒ¹é…ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©ä½ æ›´æ–¹ä¾¿çš„æ‹¿åˆ°æ•°æ®ï¼Œç®€åŒ–ä»£ç **

```js
// ç¤ºä¾‹
let obj = {
  data: {
    name: 'æœ±æ˜†é¹',
    age: 21
  }
}

// ä¸ç”¨è§£æ„èµ‹å€¼çš„æ—¶å€™
let name = obj.data.name
let age = obj.data.age

// ä½¿ç”¨è§£æ„èµ‹å€¼
let { name, age } = obj.data

```

---

### 4.ç®­å¤´å‡½æ•°

**ç‰¹ç‚¹**

- ä¸ç”¨å†™functionå…³é”®å­—
- å¯ä»¥ä¸å†™returnï¼ˆå¦‚æœä¸æ˜¯ä¸€æ ·çš„è¯ï¼Œä¸å†™çš„è¯ï¼Œå°±ä¼šåœ¨æœ€åä¸€æ ·è¿”å› return undefinedï¼‰
- å‚æ•°ä¸èƒ½é‡å¤
- åªèƒ½ä½œä¸ºå‡½æ•°ï¼Œä¸èƒ½ new ï¼Œæ²¡æœ‰åŸå‹
- â£ï¸å†…éƒ¨çš„ this ç”±å®šä¹‰æ—¶å¤–å›´æœ€æ¥è¿‘ä¸€å±‚çš„éç®­å¤´å‡½æ•°çš„ this ç»„æˆï¼ˆç®­å¤´å‡½æ•°å¤–å±‚æ²¡æœ‰åŒ…ç€functionï¼Œé‚£ä¹ˆæ’ä¸ºthisï¼‰
- â£ï¸ç®­å¤´å‡½æ•°æ²¡æœ‰ argumentsï¼Œä½†æ˜¯æœ‰æ‹“å±•å‚æ•°ï¼Œæ˜¯ES6ç”¨æ¥å–ä»£ argumentsçš„


```js

const sum =  (num1, num2) => num1 + num2;
const sum =  (num1, num2) => ({num1 + num2}); // â£ï¸è¿”å›çš„å¦‚æœæ˜¯ä¸€è¡Œï¼Œå¹¶ä¸”æ˜¯å¯¹è±¡çš„æ—¶å€™ï¼Œè¯­æ³•å¯èƒ½ä¼šæŠ¥é”™ï¼Œè¿™æ—¶å€™ï¼Œå°±è¦åŠ ä¸€ä¸ª () åœ¨å¤–é¢äº†

const fn1 = () => {
  console.log(arguments, this) // arguments æ²¡å®šä¹‰ | this æ˜¯ window
}

let obj = {
  fn2 () {
    const fn1 = () => {
      console.log(arguments, this) // fn2 çš„ arguments | this æ˜¯ objï¼ˆå› ä¸ºç®­å¤´å‡½æ•°å¤–å±‚æœ‰ function å‡½æ•° ğŸ”¥ï¼‰
    }
  }
}

```

---

**æ‹“å±•å‚æ•°**

```js
// æ³¨æ„äº‹é¡¹ï¼Œ...args å¿…é¡»æ”¾åˆ°å°¾éƒ¨æ‰è¡Œï¼Œåé¢ä¸èƒ½è·Ÿä»»ä½•å‚æ•°ï¼ˆå‰é¢å¯ä»¥åŠ ï¼Œè¿™æ ·æ‹“å±•å‚æ•°å°±æ˜¯å‰©ä¸‹çš„å‚æ•°ï¼‰
const sum = (...args) => {

  // argsæ˜¯ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ï¼Œè€Œargumentsæ˜¯ç±»æ•°ç»„
  args.forEach( item => { 
    console.log(item)
  })

}

sum(1,2,3,4,5)
```

---

**babelç¼–è¯‘ä¹‹åçš„ç®­å¤´å‡½æ•°ï¼ˆç®­å¤´å‡½æ•°å°±å°±æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼‰**

---

### 5.å¯¹è±¡çš„æ‹“å±•

**Objectæ–°å¢çš„é™æ€æ–¹æ³•**

```js
let obj1 = { a: 1, b: 2 }
let obj2 = { c: 3, d: 4 }

// Object.assign() æµ…æ‹·è´
Object.assign(obj1, obj2) // å’Œæ‹“å±•è¿ç®—ç¬¦å†™æ³•åŸºæœ¬ä¸€æ ·ï¼Œä¸ä¸€æ ·çš„åœ¨äºï¼Œè¿™ä¸ªä¼šæ”¹å˜å‚æ•°ä¸€çš„å€¼
obj1 // { a: 1, b: 2, c: 3, d: 4 } | Object.assign({}, obj1, obj2) è¿™æ ·å†™

Object.keys(obj1) // [a, b]
Object.values(obj1) // [1, 2]
Object.entries(obj1) // [ ['a', 1], ['b', 2] ]

Object.is(NaN, NaN) // true | Number.isNaN()ä¹Ÿèƒ½åˆ¤æ–­
Object.is(0, -1) // false | 
```

---

### ğŸ”¥6.Object.defineProperty

- ç®€ä»‹ï¼šES5è§„èŒƒå¼€å§‹ï¼Œåç»­ç‰ˆæœ¬è¿­ä»£ï¼Œè‡´åŠ›äºåšä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯æŠŠJSåº•å±‚çš„åŠŸèƒ½æä¾›ç»™å¼€å‘è€…ä½¿ç”¨ã€‚
- Object.defineProperty å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªï¼ˆä¹‹å‰æ˜¯æµè§ˆå™¨å†…éƒ¨ä½¿ç”¨çš„ï¼Œå¼€å‘è€…æ²¡åŠæ³•ä½¿ç”¨ï¼‰ï¼Œæ­¤æ–¹æ³•ä¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°çš„å…·æœ‰è¯¦ç»†æè¿°çš„å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›è¿™ä¸ªå¯¹è±¡
- ä½¿ç”¨
  - æ•°æ®æè¿°ç¬¦
    - value: 'xxx' å±æ€§å€¼ | é»˜è®¤ ''
    - writable: true æ˜¯å¦å¯å†™ | é»˜è®¤ false
    - configurable: true æ˜¯å¦å¯é…ç½® | é»˜è®¤ false
    - enumerable: true æ˜¯å¦å¯æšä¸¾ | é»˜è®¤ false
  - å­˜å–æè¿°ç¬¦
    - set: function () {} å±æ€§è®¿é—®å™¨ è¿›è¡Œå†™æ“ä½œæ—¶è°ƒç”¨è¯¥æ–¹æ³•
    - get: function () {} å±æ€§è®¿é—®å™¨ è¿›è¡Œè¯»æ“ä½œæ—¶è°ƒç”¨è¯¥æ–¹æ³•

---

**ä¹‹å‰æµè§ˆå™¨ å†…éƒ¨ä½¿ç”¨ Object.defineProperty çš„ç¤ºä¾‹**

```js
// ä¸å¯å†™çš„æ¡ˆä¾‹
Function.prototype = 'ä¸å¯å†™'
console.log(Function.prototype) // Æ’ () { [native code] } | æ²¡å˜

// ä¸å¯é…ç½®æ¡ˆä¾‹
window.a = 10
delete window.a // false

// å¯æšä¸¾æ¡ˆä¾‹
let obj = {
  name: 'æœ±æ˜†é¹',
  __proto__: {
    age: 20
  }
}
for (let prop in obj) {
  console.log(prop) // name age
}

// ä¸å¯æšä¸¾çš„æ¡ˆä¾‹
for (let prop in Object.prototype) {
  console.log(prop) // è™½ç„¶ Object.prototype ä¸Šæœ‰å¾ˆå¤šå¯¹è±¡ ï¼Œä½†æ˜¯ç»“æœæ˜¯ æ— 
}

```

---

**Object.defineProperty æ•°æ®æè¿°ç¬¦**

```js
let obj = {
  // name: 'æœ±æ˜†é¹' // å¦‚æœå†™ä¸Šçš„è¯ï¼Œé»˜è®¤é…ç½®éƒ½æ˜¯ true
}

// å‚æ•°ä¸€ï¼šå¯¹è±¡ | å‚æ•°äºŒï¼šå±æ€§å | å‚æ•°ä¸‰ï¼šå¯¹è¿™ä¸ªå±æ€§çš„ é…ç½®
Object.defineProperty(obj, 'name', {
    value: 'æœ±æ˜†é¹',
    writable: false, // æ˜¯å¦å¯å†™ | é»˜è®¤ false
    configurable: true, //æ˜¯å¦å¯é…ç½® | é»˜è®¤ false
    enumerable: true // æ˜¯å¦å¯æšä¸¾ | é»˜è®¤ false
})

obj.name = 1
obj.name // æœ±æ˜†é¹

delete obj.name // true
obj.name // {}
```

---

**Object.defineProperty å­˜å–æè¿°ç¬¦**

```js
let obj = {
  // name: 'æœ±æ˜†é¹' // å¦‚æœå†™ä¸Šçš„è¯ï¼Œé»˜è®¤é…ç½®éƒ½æ˜¯ true
}

let tempValue = 'æœ±æ˜†é¹ get'
// å‚æ•°ä¸€ï¼šå¯¹è±¡ | å‚æ•°äºŒï¼šå±æ€§å | å‚æ•°ä¸‰ï¼šå¯¹è¿™ä¸ªå±æ€§çš„ é…ç½®
Object.defineProperty(obj, 'name', {
    // value: 'æœ±æ˜†é¹',
    // writable: false, // æ˜¯å¦å¯å†™ | é»˜è®¤ false
    configurable: true, //æ˜¯å¦å¯é…ç½® | é»˜è®¤ false
    enumerable: true // æ˜¯å¦å¯æšä¸¾ | é»˜è®¤ false

    // set , get å’Œ value writable ä¸èƒ½å…±å­˜ï¼ˆä¼šæŠ¥é”™ï¼‰
    set(newValue) {
      tempValue = newValue
    },
    get() {
      return tempValue
    }
})


// å¦ä¸€ç§å†™æ³•
let obj1 = {
  tempValue: 'æœ±æ˜†é¹',
  get name () {
    return this.tempValue
  },
  set name (newValue) {
    this.tempValue = newValue
  }
}

obj1.name = 'æµ‹è¯•'
obj1 // {tempValue: 'æµ‹è¯•', name: 'æµ‹è¯•'}
```

**â£ï¸æˆ‘è§‰å¾—è¿™ä¸ªå†™æ³•å®šä¹‰äº†ä¸€ä¸ªå¤šä½™çš„å˜é‡ï¼Œä¸æ˜¯å¾ˆå¥½ï¼Œè‚¯å®šæœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œæˆ‘è¿˜æ˜¯å¤šå­¦ä¹ ä¸€ä¸‹å§**

---

### ğŸ”¥7.æ•°æ®åŠ«æŒ

- VueåŒå‘æ•°æ®ç»‘å®šæ ¸å¿ƒåŠŸèƒ½æ˜¯ç”± Observer, Compile, Watcher ä¸‰éƒ¨åˆ†å®ç°
- å…¶ä¸­ Observerï¼ˆç›‘å¬æ•°æ®å˜åŒ–è¿›è¡Œç›¸åº”çš„å›è°ƒ - æ•°æ®åŠ«æŒï¼‰ éƒ¨åˆ†åŠŸèƒ½å°±æ˜¯ç”¨ Object.defineProperty æ¥å®ç°çš„ï¼ˆVue2.xä¹‹åç”¨ Proxy&Reflect é‡æ„äº†ï¼‰

**æˆ‘ä»¬æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼šå½“æˆ‘ä»¬çš„æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œè®©è§†å›¾ï¼ˆé¡µé¢ï¼‰ä¹Ÿéšä¹‹æ”¹å˜**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    
    <input type="text" id="inputDemo">
    <div id="divDemo"></div>

    <script>
        
        let oInput = document.getElementById('inputDemo');
        let oDiv = document.getElementById('divDemo');

        let obj = {
            name: 'æœ±æ˜†é¹',
            me: {
                age: 20
            }
        }

        function upData () {
            oDiv.innerText = obj.me.age
        }
        
        // æ£€æµ‹å¯¹è±¡çš„æŸä¸ªå±æ€§æ˜¯å¦å‘ç”Ÿæ”¹å˜
        function Observer (data) {

            if (!data || typeof data != 'object') return data;

            Object.keys(data).forEach( key => {
                definedRective(data, key, data[key])
            })

        }

        function definedRective(data, key, val) {
            Observer(val) // é€’å½’ï¼Œè¿™æ ·è®©æ·±å±‚æ¬¡å¯¹è±¡å…·æœ‰ç›‘æ§ä½œç”¨

            Object.defineProperty(data, key, {
                get() {
                    return val
                },
                set(newValue) {
                    if (newValue == val) return;
                    val = newValue;
                    upData() // æ‰§è¡Œæ”¹å˜è§†å›¾
                }
            })
        }

        //ï¼ˆäº‹ä»¶ï¼‰è¾“å…¥æ¡†æ”¹å˜äº‹ä»¶
        oInput.addEventListener('input', function (event) {
            obj.me.age = event.target.value
        })

        Observer(obj)
        upData()

    </script>

</body>
</html>
```

<img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.notes/3.JavaScript/ES6%E4%BB%A5%E5%8F%8AJS%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95%E6%A2%B3%E7%90%86/1Object.defineProperty%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A.gif" />

---

**æ€è€ƒï¼šVueæ˜¯æ€ä¹ˆç›‘å¬åˆ° æ•°ç»„ä¸­æ”¹å˜çš„å‘¢ï¼Ÿ**

```js
// åœ¨Vueä¸­ æ•°ç»„ä¸­æ”¹å˜æƒ³è¦ç›‘å¬ï¼Œéœ€è¦ç”¨ç‰¹å®šçš„æ–¹æ³•ï¼Œä¾‹å¦‚ push pop unshift shift...ç­‰ç­‰
// åŸç†æ˜¯ Vue é‡å†™äº†è¿™äº›æ–¹æ³•
Object.defineProperty(Array.property, 'push', {

})
```

---

### ğŸ”¥8.Proxy & Reflect

- è¿™ä¸ªä¸œè¥¿æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œä½ å¯èƒ½ä¼šæƒ³äº†ï¼Œå¯ä»¥é€šè¿‡ babel è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘æˆES5ä¸å°±å¯ä»¥äº†ä¹ˆï¼Œä½†æ˜¯ babel ç¼–è¯‘æœ¬è´¨ä¸Šæ˜¯å°† ES6è¯­æ³•ç³–ç¼–æˆ ES5ä»£ç ï¼Œä½†æ˜¯ Proxy å’Œ Reflect ä¸æ˜¯è¯­æ³•ç³–ï¼Œè¿™æ˜¯æµè§ˆå™¨å†…éƒ¨å®ç°çš„ä¸œè¥¿ï¼Œç¼–è¯‘ä¹‹åå…¶å®è¿˜æ˜¯ä»–ä»¬æœ¬èº«

**Proxyï¼ˆä»£ç†ï¼‰**

- æ¤å…¥ä»£ç†æ¨¡å¼çš„æ€æƒ³ï¼Œä»¥ç®€æ´æ˜“æ‡‚çš„æ–¹å¼æ§åˆ¶å¯¹å¤–éƒ¨å¯¹è±¡çš„è®¿é—®
- åˆ©ç”¨å†…ç½®çš„ set, get æ–¹æ³•æ§åˆ¶å±æ€§çš„è¯»å†™åŠŸèƒ½ç”¨å¤„æ¯”è¾ƒå¤§ï¼Œå…¶ä½™ has, delePropery...ç­‰æ–¹æ³•ä¸å¤ªåœ¨å·¥ä½œå¼€å‘ä¸­ä½¿ç”¨ï¼Œæœ‰å…´è¶£å¯ä»¥äº†è§£ä¸‹

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    
    <input type="text" id="inputDemo">
    <div id="divDemo"></div>

    <script>
        
        let oInput = document.getElementById('inputDemo');
        let oDiv = document.getElementById('divDemo');

        let obj = {
            name: 'æœ±æ˜†é¹',
            me: {
                age: 20
            }
        }

        function upData () {
            oDiv.innerText = objProxy.name
        }

        let objProxy = new Proxy(obj, {
            // å‚æ•°ä¸€ï¼šå¯¹è±¡æœ¬èº« | å‚æ•°äºŒï¼šå¯¹è±¡çš„ å±æ€§å | å‚æ•°ä¸‰ï¼šèµ‹çš„å€¼ | å‚æ•°å››ï¼šä¸€ä¸ªProxyæ ¼å¼çš„å¯¹è±¡
            set (target, key, value, receiver) {
                Reflect.set(target, key, value);
                upData() // æ‰§è¡Œæ”¹å˜è§†å›¾
            },
            // å‚æ•°ä¸€ï¼šå¯¹è±¡æœ¬èº« | å‚æ•°äºŒï¼šå¯¹è±¡çš„ å±æ€§å | å‚æ•°ä¸‰ï¼šä¸€ä¸ªProxyæ ¼å¼çš„å¯¹è±¡
            get (target, key, receiver) {
                return Reflect.get(target, key);
            }
        })

        //ï¼ˆäº‹ä»¶ï¼‰è¾“å…¥æ¡†æ”¹å˜äº‹ä»¶
        oInput.addEventListener('input', function (event) {
            objProxy.name = event.target.value
        })

        upData()

    </script>

</body>
</html>
```

**â£ï¸ obj.me.age Proxyç›‘å¬ä¸åˆ°å˜åŒ–ï¼Œè¿™æ€ä¹ˆåŠï¼Ÿ**

---

### 9.Classï¼ˆé¢å‘å¯¹è±¡ï¼‰

**ES5æ—¶ä»£çš„ é¢å‘å¯¹è±¡**

```js
// å·¥å‚æ¨¡å¼ åˆ›å»ºå¯¹è±¡
function Preson () {
  this.name = 'äºº'
}

// æ–¹æ³•å†™åˆ°åŸå‹é“¾ä¸Š
Preson.prototype.say = function () {
  console.log('è¯´è¯')
}


// =======+ ES5 ç»§æ‰¿ +=========
// åœ£æ¯æ¨¡å¼ç»§æ‰¿æ–¹æ³•
```

---

**ES6æ—¶ä»£ é¢å‘å¯¹è±¡**

```js
class Preson {
  constructor (name, age) {
    this.name = name || 'äºº'
    this.age = age || 20
  }
  say () {
    console.log('è¯´')
  }

  // ES7 æ‰èƒ½è¿™ä¹ˆå†™ static name = 'äºº'ï¼Œ ES6 åªèƒ½å†™å‡½æ•°
  // é™æ€å†™æ³•
  static name () {
    return 'äºº'
  }

  // ES7 ç§æœ‰å±æ€§
  // name = 10
}

class Zhu extends Preson{
  constructor (sex) {
    super()
    this.sex = sex || 'ç”·'
  }
}

let zhukunpeng = new Zhu('æœ±æ˜†é¹', 21, 'ç”·') // {name: "äºº", age: 20, sex: "æœ±æ˜†é¹"}
```

---

**ES5 æ¨¡æ‹ŸClass**

ç•¥...

---

**ES7 Classï¼ˆææ¡ˆï¼Œæœ€æ–°çš„æµè§ˆå™¨æœ‰çš„ä¹Ÿæ²¡æ”¯æŒï¼Œéœ€è¦babelé™çº§ï¼Œå…ˆäº†è§£å§ï¼‰**

- static property = xxx é™æ€å±æ€§
- property = xxx ç§æœ‰å±æ€§
- @decorator è£…é¥°å™¨


---

### 10.Set

- ç®€ä»‹ï¼šSetæ˜¯ES6æä¾›ç»™æˆ‘ä»¬çš„ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆéœ€è¦newï¼‰ï¼Œèƒ½æ„é€ å‡ºä¸€ç§æ–°çš„å­˜å‚¨æ•°æ®çš„ç»“æ„
- ç‰¹ç‚¹ï¼šåªæœ‰å±æ€§å€¼ï¼ˆå’Œæ•°ç»„å·®ä¸å¤š 0:... è¿™æ ·çš„ï¼‰ï¼Œæˆå‘˜å€¼å”¯ä¸€ï¼ˆä¸é‡å¤ï¼‰
- ç”¨é€”ï¼šå¯ä»¥è½¬æˆæ•°ç»„ï¼Œå…¶æœ¬èº«å…·å¤‡å»é‡ï¼Œå–äº¤é›†ï¼Œå¹¶é›†ï¼Œå·®é›†çš„é”™ç”¨
- å¤‡æ³¨ï¼š
  - babelæ— æ³•é™çº§ï¼ˆç¼–è¯‘ä¹‹åè¿˜æ˜¯å®ƒæœ¬èº«ï¼‰ï¼Œå› ä¸ºå’Œ proxy ä¸€æ ·ï¼Œå±äºæµè§ˆå™¨å†…ç½®çš„å®ç°
  - new Set() å‚æ•°å¿…é¡»è¦æ˜¯ å…·æœ‰è¿­ä»£æ¥å£çš„ï¼ˆæ•°ç»„æ˜¯ï¼Œå­—ç¬¦ä¸²æ˜¯ï¼ŒSetä¹Ÿæ˜¯ï¼Œ......ï¼‰(åŸå‹ä¸Šå…·å¤‡ Symbolçš„å°±æ˜¯å…·å¤‡è¿­ä»£æ¥å£)

```js

let setArr = new Set('abc') // Set(3)Â {"a", "b", "c"}

// æ·»åŠ  add()
setArr.add('z') // {"a", "b", "c", "z"}
setArr.add('a') // {"a", "b", "c", "z"}

// åˆ é™¤ delete()
setArr.delete('z') // true {"a", "b", "c"}

// æ¸…ç©º clear()
setArr.clear() // Set(0)Â {}

// åˆ¤æ–­æœ‰æ²¡æœ‰æŸå€¼ has() | æ•°ç»„ä¸­å¯ä»¥ç”¨ some() every()
setArr.has('z') // fasle

// éå† forEach()
setArr.forEach(value => {
  console.log(value) // a | b  c
})

// æ‹“å±•ï¼šè¿­ä»£æ¥å£éå† for of
for (let prop of setArr) {
  console.log(prop) // a | b  c
}

// ğŸ”¥Set å’Œ æ•°ç»„çš„è½¬æ¢
let arr = [1, 2, 3]
let setArr2 = new Set(arr) // æ•°ç»„ ---ã€‹ Set
...setArr2 // Set ---ã€‹æ•°ç»„
Array.from(setArr2) // ğŸ”¥èƒ½æŠŠç±»æ•°ç»„ï¼Œå’Œå…·å¤‡è¿­ä»£æ¥å£çš„ç±»å‹ï¼Œè½¬ä¸º æ•°ç»„

```

---

**ğŸ”¥Setåº”ç”¨åœºæ™¯**

```js

// æ•°ç»„å»é‡
[...new Set([2,3,4,5,6,6,2,1,4])] // [2, 3, 4, 5, 6, 1]


let arr1 = [1, 2, 3]
let arr2 = [3, 4, 5]

// å¹¶é›†
[...new Set([...arr1, ...arr2])] // [1, 2, 3, 3, 4, 5]

// äº¤é›†
let setArr1 = new Set(arr1)
let setArr2 = new Set(arr2)
[...setArr1].filter(item => setArr2.has(item)) // [3]

// å·®é›†
let setArr1 = new Set(arr1)
let setArr2 = new Set(arr2)
[...setArr1].filter(item => !setArr2.has(item)) // [1, 2]
[...setArr2].filter(item => !setArr1.has(item)) // [4, 5]
// æŠŠä¸Šé¢ åˆå¹¶å°±å¥½äº†

```

---

### 11.Mapï¼ˆé”®å€¼å¯¹ï¼‰

```js
const pres = new Map()
pres.set(name, 'æœ±æ˜†é¹')
pres.set(age, 20)


```

---

### 12.Symbol

è¿™æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ï¼ˆES9æˆ–è€…å…¶ä»–ç‰ˆæœ¬ä¸­ï¼Œæœ‰bigintè¿™ä¸ªç±»å‹ï¼‰

```js
// ç”¨å¤„ï¼šå½“åšå¯¹è±¡çš„å”¯ä¸€é”®å€¼
const s1 = Symbol()

const obj = {
  [s1]: 'æœ±æ˜†é¹'
}

obj[s1] // æœ±æ˜†é¹
```

---

### ğŸ”¥13.å¼‚æ­¥ç¼–ç¨‹

##### 1.promiseåˆæ¢

- å¼‚æ­¥ç¼–ç¨‹æ¦‚å¿µï¼š
  - æ— è®ºæ˜¯æµè§ˆå™¨è¿˜æ˜¯Nodeç¯å¢ƒä¸­ï¼Œéƒ½ä¼šä½¿ç”¨JavaScriptè¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚å®šæ—¶å™¨ï¼Œäº‹ä»¶ï¼Œajaxï¼Œæˆ–è€…nodeç¯å¢ƒä¸­çš„æ–‡ä»¶è¯»å–ç­‰
  - éšç€å¼‚æ­¥ç¼–ç¨‹çš„å°±æ˜¯å›è°ƒæœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´å¼‚æ­¥é¿å…ä¸äº†è¦ä½¿ç”¨å›è°ƒ
- å¼‚æ­¥ç¼–ç¨‹çš„é—®é¢˜
  - äº§ç”Ÿå›è°ƒåœ°ç‹±ï¼Œéš¾äºç»´æŠ¤å’Œæ‹“å±•
  - try catchåªèƒ½æ•è·åŒæ­¥ä»£ç ä¸­å‡ºç°çš„å¼‚å¸¸
  - åŒæ­¥å¹¶å‘çš„å¼‚æ­¥å­˜åœ¨ä¸€å®šçš„é—®é¢˜

**Promiseä»‹ç»**

- ES6 çš„ promise å¯ä»¥è§£å†³å›è°ƒåœ°ç‹±ï¼Œä»¥åŠåŒæ­¥å¹¶å‘çš„å¼‚æ­¥é—®é¢˜ï¼ˆå¼‚æ­¥æ“ä½œçš„å¼‚å¸¸æ•è·æœ‰å…¶ä»–æ–¹æ³•è§£å†³ï¼‰
- ä½†ä¾æ—§ä¼šæœ‰æ˜æ˜¾çš„å›è°ƒç—•è¿¹ï¼Œä¹‹åå­¦ä¹  async/await å°±èƒ½è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥å’ŒåŒæ­¥ä¸€æ ·

---

##### 2.å¼‚æ­¥çš„ä½¿ç”¨åœºæ™¯ï¼ˆæˆ‘ä»¬ä½¿ç”¨Nodeæ¥è¯•è¯•ï¼‰

```js
// Nodeæ–‡ä»¶è¯»å–ï¼Œæ¼”ç¤ºå¼‚æ­¥ä½¿ç”¨ä¸­ å›è°ƒçš„é—®é¢˜ âŒ

// æ–‡ä»¶è¯»å–
let fs = require('fs')

fs.readFile('./a.js', 'utf-8', (err, data1) => {
    console.log(data1)  
    fs.readFile(data1.url, 'utf-8', (err, data2) => {
        console.log(data2)
        fs.readFile(data2.url, 'utf-8', (err, data3) => {
            console.log(data3)
        })
    })
})


// å®šæ—¶å™¨ï¼Œæ¼”ç¤ºå¼‚æ­¥ä½¿ç”¨åœºæ™¯ä¸­ æ•è·ä¸åˆ° å¼‚å¸¸çš„é—®é¢˜ âŒ

try {
  setTimeout( () => {
      console.log(a)
  }, 1000)
} catch (e) {
    console.log(e)
}


// å¹¶å‘å¼‚æ­¥æ“ä½œï¼ˆæˆ‘ä»¬æƒ³ç­‰æ‰€æœ‰çš„å¼‚æ­¥éƒ½ç»“æŸä¹‹åï¼Œå†å¹²ä¸€ä»¶äº‹æƒ…ï¼‰
// æˆ‘æƒ³æƒ³è¯»å‡ ä¸ªæ–‡ä»¶ï¼Œç„¶åéœ€è¦ç­‰éƒ½å®Œæˆä¹‹åï¼Œå†åšæ“ä½œï¼Œè¿™ä¸ªåº”è¯¥æ€ä¹ˆåšâ“

// è¿™é‡Œæœ‰ä¸ªå‘å¸ƒè®¢é˜…è€…æ¨¡å¼å¾ˆå¥½ç”¨ï¼Œè€Œä¸”é‚£ä¸ª --æ—¶é—´çš„éå¸¸çš„å¦™

```

---

##### 3.Promiseä½¿ç”¨1

```js
// ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ åŒæ­¥æ‰§è¡Œçš„
let promise = new Promise( () => {
  console.log(0)
})
console.log(1)

// 0 1
```

**åŸºæœ¬ä½¿ç”¨**

```js
let promise = new Promise((res, rej) => {

  setTimeout( () => {
    Math.random() * 100 > 60 ? res('ok') : rej('no')
  }, 1000)

})

// Promise æœ‰ä¸‰ç§çŠ¶æ€ pending è¿›è¡Œæ—¶ | onFulfilled æˆåŠŸ | onRejected å¤±è´¥
// â£ï¸ï¼š.then é‡Œé¢çš„å‡½æ•°ï¼Œæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ˆæ”¾åˆ°äº†å¾®é˜Ÿåˆ—é‡Œé¢ï¼‰
promise.then( (res) => {
  console.log('res', res)
}, (rej) => {
  console.log('rej', rej)
})

```

**é“¾å¼æ“ä½œ**

```js
let promise = new Promise((res, rej) => {

  setTimeout( () => {
    Math.random() * 100 > 60 ? res('ok') : rej('no')
  }, 1000)

})

// Promise æœ‰ä¸‰ç§çŠ¶æ€ pending è¿›è¡Œæ—¶ | onFulfilled æˆåŠŸ | onRejected å¤±è´¥
// â£ï¸ï¼š.then é‡Œé¢çš„å‡½æ•°ï¼Œæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼ˆæ”¾åˆ°äº†å¾®é˜Ÿåˆ—é‡Œé¢ï¼‰
promise.then( (res) => {
  console.log('res', res)
  return 20
}, (rej) => {
  console.log('rej', rej)
  return 30
}).then( (res) => {
  console.log('ok:', res) // ok:20 | ok:30
}, (rej) => {
  console.log('no:', rej) // åªæœ‰ä¸Šé¢æŠ›å‡ºé”™è¯¯æ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼ˆè¿™é‡Œæœ‰ç‚¹ç»•ï¼Œä½†æ˜¯æ²¡äº‹ï¼‰
})

```

---

##### 4.Promiseä½¿ç”¨2

- then() æ³¨å†Œå‡½æ•°è¿”å›å€¼
- catch() å¼‚å¸¸æ•è·
- finally() æœ€åå¤„ç†å‡½æ•°
- Promise.all() åŒæ­¥å¹¶å‘å¼‚æ­¥çš„ç»“æœ
- Promise.race() è°å…ˆæˆåŠŸå°±å¤„ç†è°

```js
let promise = new Promise( (res, rej) => {
  res()
})

promise.then( res => {
  throw new Error('å‡ºé”™')
}).catch( err => {
  console.log(err) // Error: å‡ºé”™ at /Users/zhukunpeng/Desktop/Git-notes/b.js:6:11
}).then( res => {

}).finally( () => {
  console.log('æœ€åå¤„ç†çš„å‡½æ•°')
}) 

// .catch() ä¸æ˜¯ç»“æŸï¼Œåé¢è¿˜å¯ä»¥è¿›è¡Œ .then() æ“ä½œï¼Œ.finally() æ˜¯æœ€åå¤„ç†çš„å‡½æ•°ï¼Œåé¢ä¸èƒ½ .then() äº†

```

**Promise.all() && Promise.rece()**

```js
function readFile (path) {
  return new Promise( (res, rej) => {
    fs.readFile(path, 'utf-8', (err, data) => {
      if (data) res(data);
    })
  })
}

// Promise.all() å¯ä»¥å°†å¤šä¸ªpromiseå®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ promiseå®ä¾‹
// â£ï¸ï¼šå¦‚æœéƒ½æˆåŠŸï¼Œé‚£ä¹ˆä¼šè¿”å›ä¸€ä¸ªåŒ…å«å„ä¸ªæ•°æ®çš„æ•°ç»„
// â£ï¸ï¼šå¦‚æœæœ‰å¤±è´¥çš„è¯ï¼Œä¼šè¿”å›ç¬¬ä¸€ä¸ªè§¦å‘å¤±è´¥çš„å€¼çš„å†…å®¹
Promise.all([readFile('./a.js'), readFile('./b.js'), readFile('./c.js')]).then( res => {
  console.log(res) // ['a.js', 'b.js', 'c.js']
})

Promise.rece([readFile('./a.js'), readFile('./b.js'), readFile('./c.js')]).then( res => {
  console.log(res) // 'a.js' || 'b.js' || 'c.js'
})

```





---

##### 5.async/await


- è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡
- ç±»ä¼¼äºåŒæ­¥çš„ä»£ç ï¼Œæ¥å†™å¼‚æ­¥ä»£ç 
- try catch å¯ä»¥æ•è·åˆ°å¼‚å¸¸
- åŒæ­¥å¹¶å‘ éœ€è¦å†™é¢å¤–çš„ å‡½æ•°









---

## JS å„ä¸ªå†…ç½®APIåŠŸèƒ½å®ç°

### 1.forEachå®ç°

```js
Array.prototype.myForEach = function(func) {
  let _arr = this,
      len = _arr.length,
      parmas = arguments[1] || window;
  
  for (let i = 0; i < len; i++) {
    func.apply(parmas, [_arr[i], i, _arr])
  }
}

let arr = [1, 2, 3]

arr.myForEach( (item, index, self) => {
    console.log(item, index, self, this)
}, {name: '123'})

// ä½“ä¼šï¼šforEach çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯éå†ï¼Œå¹¶ä¸èƒ½ä¿®æ”¹é‡Œé¢å„ä¸ªçš„å€¼ï¼›map æ‰æ˜¯é‚£ç§å¯ä»¥æ“ä½œæ•°ç»„æ¯ä¸€é¡¹çš„å€¼
```

---

### 2.filterï¼ˆè¿‡æ»¤ï¼‰

```js
// æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ | å‚æ•°å’Œ forEach ä¸€æ ·ï¼Œ ele index self this
// æ¯ä¸€é¡¹æ‰§è¡Œä¸­ä¼šè¿”å› true false å¦‚æœæ˜¯ true å°±å°†è¿™ä¸€é¡¹è¿”å›ç»™æœ€åè¿”å›çš„æ–°æ•°ç»„ä¸­
Array.prototype.myFilter = function (func) {

  let _arr = this,
      len = _arr.length,
      parmas = arguments[1] || window,
      newArr = [];

  for (let i = 0; i < len; i++) {
    func.apply(parmas, [_arr[i], i, _arr]) ? newArr.push(_arr[i]) : '';
  }

  return newArr
}

let arr = [1, 2, 3]

arr.myFilter( item => item > 1); // [2, 3]
```

---

### 3.mapï¼ˆæ˜ å°„ï¼‰

```js
Array.prototype.myMap = function (func) {

  let _arr = this,
      len = _arr.length,
      params = arguments[1] || window,
      newArr = [];
  
  for (let i = 0; i < len; i++) {
    newArr.push(func.apply(params, [_arr[i], i, _arr]))
  }

  return newArr

}

let arr = [1, 2, 3]

arr.myMap(item => item += 2) // [3, 4, 5]

// åˆ°è¿™é‡Œæˆ‘æ‰çŸ¥é“ä¸ºä»€ä¹ˆ Map å¯ä»¥æ§åˆ¶å¾ªç¯æ¯ä¸€ä¸ªçš„å€¼ï¼Œè€ŒforEachä¸è¡Œï¼Œå› ä¸º forEach å°±æ˜¯éå†ç”¨çš„ï¼Œä¸åšè¿”å›çš„æ“ä½œ
```

---

### 4.everyï¼ˆæ˜¯å¦éƒ½ç¬¦åˆè¦æ±‚ï¼‰

```js
Array.prototype.myEvery = function (func) {
  let _arr = this,
      len = _arr.length,
      params = arguments[1] || window;

  for (let i = 0; i < len; i++) {
    if (!func.apply(params, [_arr[i], i, _arr])) {
       return false;
    }
  }

  return true;

}

let arr = [1, 2, 3]

arr.myEvery( item => item > 1) // false
arr.myEvery( item => item > 0) // true
```

---

### 5.someï¼ˆæ˜¯å¦æœ‰è‡³å°‘ä¸€ä¸ªç¬¦åˆè¦æ±‚ï¼‰

```js
Array.prototype.mySome = function (func) {
  let _arr = this,
      len = _arr.length,
      params = arguments[1] || window;
  
  for (let i = 0; i < len; i++) {
    if (func.apply(params, [_arr[i], i, _arr])) {
      return true;
    }
  }

  return false;

}

let arr = [1, 2, 3]

arr.mySome( item => item > 2) // true
arr.mySome( item => item > 3) // false


```

---

## Promise+

### AOP

```js

/**
 * AOP ç¼–ç¨‹
 */
function fn(name) {
  console.log('hello world ' + name)
}

Function.prototype.before = function(callback) {
  return (...args) => {
    callback();
    this(...args);
  }
}

let newFn = fn.before(() => {
  console.log('åœ¨å‡½æ•°æ‰§è¡Œå‰ æ‰§è¡Œ')
})

newFn('æœ±æ˜†é¹') 

// åœ¨å‡½æ•°æ‰§è¡Œå‰ æ‰§è¡Œ
// hello world
```

---

### å‡½æ•°æŸ¯é‡ŒåŒ–

```js

/**
 * å‡½æ•°æŸ¯é‡ŒåŒ–
 */

const curring = (fn, arr = []) => {
  let len = fn.length // å‡½æ•°çš„lengthå°±æ˜¯å‚æ•°çš„ä¸ªæ•°
  return (...args) => {
    let newArgs = [...arr, ...args]
    return newArgs.length == len
      ? fn(...newArgs)
      : curring(fn, newArgs)
  }
}

let newSum = curring((a, b, c, d, f) => {
  return a + b + c + d + f
})

console.log(newSum(1)(2)(3)(4)(5)) // 15
```

---

### å»¶è¿Ÿæ‰§è¡ŒåŸç†

```js

/**
 * æ‹“å±•ï¼šloash after å‡½æ•°åŸç†ï¼ˆå‡½æ•°åœ¨ç¬¬å‡ æ¬¡æ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œè¿ç”¨äº†é—­åŒ…ï¼ŒPromise.all å·®ä¸å¤šä¹Ÿæ˜¯è¿™ä¸ªåŸç†ï¼‰
 */
function after(times, callback) {
  return (...args) => {
    if (--times === 0) {
      callback(...args)
    }
  }
}

let newFn = after(3, (name) => {
  console.log('hello world  ' + name)
})

newFn()
newFn()
newFn('æœ±æ˜†é¹') // hello world æœ±æ˜†é¹
```

---

::: tip å‘å¸ƒè®¢é˜…æ¨¡å¼ å’Œ è®¢é˜…è§‚å¯Ÿè€…æ¨¡å¼ ä¹‹é—´çš„å…³ç³»
å‘å¸ƒè®¢é˜…ï¼Œå‘å¸ƒ å’Œ è®¢é˜… ä¹‹é—´æ²¡æœ‰è”ç³»ï¼Œå°±å’Œä¸­ä»‹æ¨¡å¼ä¸€æ ·ï¼Œç”±ä¸­ä»‹æ¥è¿›è¡Œå¤„ç†

è®¢é˜…å’Œè§‚å¯Ÿè€… ä¹‹é—´æœ‰å…³ç³»ï¼Œè§‚å¯Ÿè€…é‡Œé¢å­˜ç€ è®¢é˜…è€…çš„æ–¹æ³•ï¼Œåˆ°æ—¶å€™ è§‚å¯Ÿè€…å˜åŒ–äº†ï¼Œä¼šé€šçŸ¥è®¢é˜…è€…æ‰§è¡Œæ–¹æ³•
:::

<img style="width: 500px" src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.notes/3.JavaScript/ES6%E4%BB%A5%E5%8F%8AJS%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95%E6%A2%B3%E7%90%86/clipboard_20200906100429.png" />

---

æˆ–è€…ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼šç§Ÿæˆ¿

- å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå°±ç›¸å½“äºï¼Œç§Ÿæˆ·çš„ï¼Œå’Œæˆ¿ä¸œ ä¸è®¤è¯†ï¼Œç§Ÿæˆ·ç§Ÿæˆ¿è¦æ‰¾ä¸­ä»‹ï¼Œæˆ¿ä¸œå…ˆæŠŠæˆ¿å­ç§Ÿå‡ºå»ï¼Œä¹Ÿè¦æ‰¾æˆ¿ä¸œï¼Œç§Ÿæˆ·é€šçŸ¥ä¸­ä»‹è¦ç§Ÿæˆ¿äº†ï¼Œä¸­ä»‹æ‰¾åˆ°åˆé€‚çš„äº†ï¼Œå°±é€šçŸ¥æˆ¿ä¸œç­¾åˆåŒ
- è§‚å¯Ÿè®¢é˜…æ¨¡å¼ï¼Œç›¸å½“äºï¼Œç§Ÿæˆ·å’Œæˆ¿ä¸œ è®¤è¯†ï¼Œç§Ÿæˆ·æƒ³ç§Ÿæˆ¿ç›´æ¥æ‰¾æˆ¿ä¸œç§Ÿå°±è¡Œäº†ï¼Œç§Ÿæˆ·è¿™é‡Œå­˜æ”¾è¿™ æˆ¿ä¸œç§Ÿæˆ¿çš„æ–¹æ³•ï¼Œå°‘äº†ä¸€ä¸ªä¸­ä»‹çš„

---

### å‘å¸ƒè®¢é˜…

> å…¶å®å¯¹è¿™é‡Œæˆ‘è¿˜æ˜¯ä¸å¤ªç†è§£ï¼Œæ„Ÿè§‰è¿˜æœ‰æ›´å¥½çš„ç¤ºä¾‹

```js
const eventObj = {
  _arr: [], // ä¸­ä»‹å­˜æ”¾ï¼Œè®¢é˜…äº‹ä»¶
  
  on(fn) {
    this._arr.push(fn)
  },

  emit() {
    this._arr.forEach(fn => fn())
  }
}

function fn1() {
  console.log('ç§Ÿæˆ¿1')
}

function fn2() {
  console.log('ç§Ÿæˆ¿1')
}

eventObj.on(fn1) // è®¢é˜…
eventObj.on(fn2) // è®¢é˜…

eventObj.emit() // æ‰§è¡Œæ‰€æœ‰çš„è®¢é˜…äº‹ä»¶
```

---

### è§‚å¯Ÿè€…æ¨¡å¼

```js
/**
 * è§‚å¯Ÿè€…æ¨¡å¼
 */

class Subject {
  constructor(name) {
    this.name = name
    this.Observers = []
    this.state = 'ç©'
  }

  // è¢«è§‚å¯Ÿè€…ä¸­è¦å­˜æ”¾æ‰€æœ‰çš„è§‚å¯Ÿè€…
  attach(o) {
    this.Observers.push(o)
  }

  setState(newState) {
    this.state = newState
    this.Observers.forEach(o => o.update(this))
  }
}

class Observer {
  constructor(name) {
    this.name = name
  }

  update(body) {
    console.log(`${body.name}è·Ÿ${this.name}è¯´${body.state}`)
  }
}

// å°å®å®

let body = new Subject('å°å®å®')
let o1 = new Observer('çˆ¸çˆ¸')
let o2 = new Observer('å¦ˆå¦ˆ')

body.attach(o1)
body.attach(o2)

body.setState('æœ‰äººæ‰“æˆ‘')

// å°å®å®è·Ÿçˆ¸çˆ¸è¯´æœ‰äººæ‰“æˆ‘
// å°å®å®è·Ÿå¦ˆå¦ˆè¯´æœ‰äººæ‰“æˆ‘
```

---

### ç®€å•ç‰ˆæœ¬

```js
class MyPromise{

  constructor(executor) {
    this.status = 'pending' // pending Fulfilled Rejected
    this.value = undefined; // æ­£ç¡®è¿”å›ä¿¡æ¯
    this.reason = undefined; // é”™è¯¯è¿”å›ä¿¡æ¯
    
    this.resovleArr = [] // resovle
    this.rejectArr = [] // reject 


    // æˆåŠŸ
    const resolve = (val) => {
      if (this.status === 'pending') {
        this.status = 'Fulfilled';
        this.value = val;
        this.resovleArr.forEach(fn => fn(this.val));
      }
    }

    // å¤±è´¥
    const reject = (reason) => {
      if (this.status === 'pending') {
        this.status = 'Rejected';
        this.reason = reason;
        this.resovleArr.forEach(fn => fn(this.reason));
      }
    }

    try {
      executor(resolve, reject)
    } catch (error) {
      reject(e)
    }
  }

  then(onFulfilled, onRejected) {
    
    if (this.status == 'Fulfilled') {
      onFulfilled(this.value)
    }

    if (this.status == 'Rejected') {
      onRejected(this.reason)
    }

    if (this.status == 'pending') {
      
      this.resovleArr.push(() => {
        onFulfilled(this.value)
      })

      this.rejectArr.push(() => {
        onRejected(this.reason)
      })
    }
  }
}


const promise = new MyPromise((resovle, reject) => {
  setTimeout(() => {
    resovle('æˆåŠŸ')
  }, 1000);
})

promise.then(res => {
  console.log('res', res);
})

// é—®é¢˜1ï¼š.then æ˜¯æ€ä¹ˆé“¾å¼è°ƒç”¨çš„
```

---

### ä¼ ç»Ÿå®ç°

```js
// å®ç°çš„åŸç†

// promiseæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œèƒ½æ ¹æ®ä¸åŒçš„çŠ¶æ€ è§¦å‘ä¸åŒçš„å›è°ƒ
// Pending ç­‰å¾… | Fulfilled æˆåŠŸ | Rejected å¤±è´¥

// å‚æ•°ä¼ ä¸€ä¸ªå‡½æ•°ï¼Œ
function MyPromise (fn) {

    // promiseæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œèƒ½æ ¹æ®ä¸åŒçš„çŠ¶æ€ è§¦å‘ä¸åŒçš„å›è°ƒ
    // pending ç­‰å¾… | Fulfilled æˆåŠŸ | Rejected å¤±è´¥

    let that = this
    that.status = 'pending';
    that.resolveValue = null;
    that.rejectValue = null;
    
    // å¦‚ä½•è§£å†³å¼‚æ­¥å‘¢ï¼Ÿæˆ‘ä»¬æ‰§è¡Œçš„æ—¶å€™å…ˆä¸æ‰§è¡Œï¼Œç­‰åˆ°res() è§¦å‘çš„æ—¶å€™æ‰è§¦å‘ï¼Œæˆ‘ä»¬å…ˆè®°å½•ä¸‹
    that.ResoveCallBackLisst = []
    that.RejctCallBackList = []

    // æˆåŠŸ
    function resolve (val) {
        if (that.status === 'pending') {
            that.status = 'Fulfilled'
            that.resolveValue = val
            that.ResoveCallBackLisst.forEach(ele => ele())
        }   
    }

    // å¤±è´¥
    function reject (val) {
        if (that.status === 'pending') {
            that.status = 'Rejected'
            that.rejectValue = val
            that.RejctCallBackList.forEach(ele => ele())
        }
    }

    try {
        fn(resolve, reject)
    } catch(e) {
        reject(e)
    }
    
}

MyPromise.prototype.then = function (onFulfilled, onRejected) {
    var that = this

    if (that.status === 'pending') {
        
        that.ResoveCallBackLisst.push(() => {
            onFulfilled(that.resolveValue)
        })

        that.RejctCallBackList.push(() => {
            onRejected(that.rejectValue)
        })

    }

    if (that.status === 'Fulfilled') {
        onFulfilled(that.resolveValue);
    }

    if (that.status === 'Rejected') {
        onRejected(that.rejectValue);
    }

}


let promise = new MyPromise( ( res, rej) => {
    // setTimeout( () => {
    //     res('ä½ å¥½ä¸–ç•Œ')
    // }, 3000)
    res('ä½ å¥½ä¸–ç•Œ')
})

promise.then( res => {
    console.log(res)
})
```


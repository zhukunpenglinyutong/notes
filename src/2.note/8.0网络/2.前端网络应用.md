# 2.前端网络应用

::: warning
此处结构混乱，内容不全，完善中...
:::

## 🥔第一部分：HTTP协议

::: tip
之前总是听一些名词，http，tcp/ip，*层网络模型，报头，报文，三次握手，五次挥手，HTTPS...等等名词，这些到底是什么，有什么关系，我要搞懂
:::

### 1.网络模型

<img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.notes/8.0%E7%BD%91%E7%BB%9C/1.%E5%89%8D%E7%AB%AF%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/1.%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B.png" />

- 应用层（HTTP,FTP）：为应用软件提供了很多服务，
- 传输层（TCP/IP，UDP）：向用户提供可靠的端到端服务（如何分包数据，如何拼装等等）
- 网络层：数据在节点之间传输创建逻辑链路（听不懂啥意思，举个例子，我要是访问百度，这一层就规定了，我应该怎么去找，这个逻辑关系就是网络层帮我们去创建的）
- 数据链路层：在通信实体之间建立数据链路连接
- 物理层：定义物理设备如何传输设备（电脑硬件，网卡端口，网线...）

### 2.HTTP发展历史

- HTTP/0.9：只有一个命令GET，没有header等描述数据的信息，服务器发送完毕，就关闭TCP连接
- HTTP/1.0：增加了很多命令（POST...等等），增加了 status code（状态码） 和 header（请求头，或者返回头，返回体的数据），还增加了多字符集支持，多部分内容发送，权限，缓存等
- HTTP/1.1：支持持久连接（TCP不立刻关闭 keep-live），pipeline（在一个链接里面发送多个请求），增加host和其他一些命令
- HTTP/2.0：所有数据以二进制进行传输，并行效率更高，增加头信息压缩以及主动推送

---

### 3.HTTP的三次握手

> HTTP只有请求和响应，不存在连接这个概念 TPC的连接进行的（请求和响应都是数据包，他们之间传输需要一个通道 TCP）

**HTTP创建之前TCP链接会有三次握手（为什么要有三次握手呢？为了防止无用的链接）**

- 客户端会发送一个数据包（SYN=1,Seq=X）给服务器端
- 服务器端收到这个数据包，就会开启一个TCP的端口，并返回给客户端一个数据包（SYN=1,ACK=X+1,Seq=Y），表示服务器端允许你创建链接了
- 客户端收到服务器端的数据包，然后返回数据包 (ACK=Y+1,Seq=Z)，表示我也收到了，可以发给我数据了（这时候才发送数据）

**HTTP关闭之前 TCP链接会有一个四次挥手的过程**

由于Tcp连接是进行全双工工作的，因此每个方向都必须单独进行关闭，这个原则是当一方完成他的数据发送的时候就发送一个FIN来终止这个方向的连接，收到这个FIN意味着这个方向上没有数据的流动，一个TCP连接在收到这个FIN之后还能发送消息，首先执行关闭的一方进行主动的关闭，而另一方进行被动的关闭

- TCP发送一个FIN，用来关闭客户到服务端的连接
- 服务端收到这个FIN，他发回一个ACK，确认收到序号为收到序号+1，和SYN一样，一个FIN将占用一个序号
- 服务端发送一个FIN到客户端，服务端关闭客户端的连接
- 客户端发送ACK报文确认，并将确认的序号+1，这样关闭完成

---


### 🔥4.HTT协议详解

**请求报文（请求行，请求头，请求体）**

- 起始行（General）：GET 资源 HTTP/1.1
    - Request URL：请求地址
    - Request Method：请求类型（GET,POST...）
    - Status Code：请求状态（状态码）
    - Referrer Policy：
    - ...
- 请求头（请求报文）
    - Accept：我这个浏览器能够接收什么资源
    - Accept-Encoding: 浏览器接受数据的格式是什么？可以设置支不支持gzip格式（压缩格式）等
    - Accept-Language：接收的语言
    - Coche-Control：缓存相关
    - 🔥Connetion：keep-alive（http的一种 连接模式，最常用的是长连接 keep-alive）
        - 短连接：每一次http的请求和响应，都会反复建立和断开TCP连接，占用服务器IO操作
        - 长连接：建立一个TCP链接，然后进行多次HTTP通信
    - Cookie：
    - Host：访问的网站
    - User-Agent：包含浏览器的一些信息，电脑系统等，就是浏览器向服务器介绍自己的一个（做爬虫的时候能用到，因为反爬虫的一个就是判断你是不是浏览器）
    - ...

---

**响应报文（响应行，响应头，响应体）**

- 响应行
- 响应头（响应报文）
    - Coche-Control：缓存相关
    - Connetion：keep-alive（返回形式是长连接）
    - Content-Encoding: gzip（返回的格式）
    - Content-Type: text/html（返回的类型）
    - Date: 缓存相关（时间戳）
    - Expires：缓存相关
    - Sever：服务器（例如 NGINX）
    - ...


---

**响应状态码**

- 1xx：指示信息 - 表示请求已接收，继续处理（用到异步处理上，后端常用，前端很少见）
- 2xx：成功 - 表示请求被成功接收，理解，接受
- 3xx：重定向 - 要完成请求必须进行更近一步的操作（服务器让你读本地缓存的时候可以用到，服务器端也能能用）
- 4xx：客户端错误 - 请求有语法错误或请求无法实现
- 5xx：服务器端发生错误 - 服务器未能实现合法的请求（后端程序出错，网络出错，服务器服务错误）

---

**请求方法**

- GET
- POST
- PUT
- DELETE
- HEAD
- TRACE
- CONNECT
- OPTIONS: 请求查询服务器性能或者查询与资源相关的选项和需求

---

### 5.CORS跨域请求和限制与解决

一句话点醒了我，让我知道什么是跨域，

当你发送一个 跨域请求的时候，其实服务器已经返回给了你想要的内容，但是，但是，这时候，浏览器会审视返回的数据是否满足同源策略（同端口，同协议，同IP）规则，不满足而且返回的数据有没有设置 "Access-Control-Allow-Origin": "*"，允许跨域，这时候就会浏览器忽略掉，注意是被浏览器忽略掉。也就是跨步跨域，是浏览器的规则

这也就解释了为什么，img 标签没有跨域，因为这是浏览器的规则，浏览器规定了 img 跨域不准守跨域

---

> 什么是跨域（我个人的观点）

上网访问资源走的是HTTP协议，HTTP协议只有请求和响应，而数据传输是TCP协议，在网页上报的那些跨域，其实并不是后端没发给你，而是浏览器的同源策略规则导致的，其实只要是你请求的数据，服务器端都会给你，浏览器有跨域，是浏览器的规则而已

这也就解释了服务器端为什么没有跨域...因为跨域是浏览器的限制规则
还有为什么 img script link等标签能跨域...因为还是浏览器的规则，反正数据都拿到了，能不能显示，报不报跨域，还是浏览器说的算

---

**JSONP实现跨域（浏览器允许，link，img，srcipt标签 允许跨域）**

---

### 6.CORS跨域限制以及预请求验证

---

### 7.HTTP长连接

所谓的长连接就是，HTTP请求和响应，是建立在TCP连接之上的（TCP是桥梁），在一个HTTP完成之后，如果不想断开 TCP 连接，还想接着用 HTTP ，那么就需要使用长连接，返回头中具有 Connection: keep-alive

为了提高性能，我们需要并发HTTP连接

---

### 8.数据协商

> 规定客户端发送什么格式的数据，服务器端返回什么格式的数据

**客户端请求的时候**

- Accept：我想要是数据格式
- Accept-Encoding：我想要的编码方式（使用哪种数据压缩）
- Accept-Language：展示的语言
- User-Agent：表示浏览器的一些信息（根据这个我们就能返回移动端的网页，或者PC端的网页）

**服务器端返回的时候**

- Content-Type：
- Content-Encoding：
- Content-Language：


---

### 9.URI-URL和URN

**URI：统一资源标识符（找资源的一种规则）**

用来唯一标识互联网上的信息资源，包括URL和URN

**URL：统一资源定位器**

格式：http[s]://user:pass@host.com:80/path?query=string#hash

**URN：永久统一资源定位符**

在资源移动之后还能被找到，目前还没有非常成熟的使用方案


---

### 10.从输入网址到展示页面，这里面经历了什么？

- 用户输入网址 按下回车
- 浏览器第一件事：先看网络通不通（再深一层就是路由器，网关）（浏览器如何判断网络通不通）
- 网络通的话，浏览器操作 计算机底层发送网络请求的API，向DNS发送解析（因为浏览器不认识域名）
- DNS服务器给浏览器返回了 IP地址，浏览器继续 通过这个IP地址继续发送（因为浏览器和目标地址之间，不可能一条线通着的，中间还有很多透明设备（对于用户是不可见的），网关，路由器等等），经过一些列的转发之后，到达目的地（唯一的服务器）
- 服务器接收到请求之后，经过一些处理，把响应结果返回（字符串）
- 返回过程也经过一些路由，最终返回到 用户浏览器中

**猫 和 路由器**，猫：是和 各个通信商之间的一条链路，路由器：路铺好了，路由器就是告诉怎么走的，就是告诉 DNS服务器

---

### 11.Redirect

你要请求的资源换地方了，如果资源搬到别的地方了，如果之前的链接还在用的话，直接访问会报 404，为了防止这个，可以设置Redirect（状态码报302 临时跳转）

---

### 12.CSP（内容安全策略）

> 内容安全策略（CSP）用于检测和减轻用于 Web 站点的特定类型的攻击，例如 XSS 和数据注入等。该安全策略的实现基于一个称作 Content-Security-Policy 的 HTTP 首部。

- 限制资源获取
- 报告资源获取越权
- default-src 限制全局
- 制定资源类型
- 例如设置返回头："Content-Security-Policy": "default-src http: https:" 就可以使网站不能加载内嵌式脚本，只能加载外部脚本链接，防止了XSS攻击
- "Content-Security-Policy": "default-src \'self'\" 限制只能加载自己网址下的 外部脚本连接，当然还有其他的设置
- 如果发现了非法请求的话，怎么提醒我们呢："Content-Security-Policy": "default-src \'self'\; report-url /接口" 如果触发了这个策略，就会调用 /接口，这时候监听这个接口就行
- 更多去MDN上看吧

---

## 🥝第二部分：缓存

> 缓存机制：浏览器 ---》 无缓存 ---》请求服务器 ---》请求响应，协商缓存

### 缓存头Cache-Control的含义和使用

- 其他
    - no-store
    - no-transform

---




---

### 缓存验证Last-Modified && Etag

**Last-Modified 上次修改时间**

配合 If-Modified-Since 或者 If-Unmodified-Since 使用（对比上次修改时间以验证资源是否需要更新）

**Etag**

数据签名（对hash计算）

配合 If-Match 或者 If-Non-Match 使用

对比资源的签名判断是否使用缓存


---

## 🍈第三部分：cookie & session & token

cookie 是 服务器返回内容的时候，通过Set-Cookie 这个属性，设置到浏览器中一个字符串的内容，设置了cookie，下次请求就会自动带上，是键值对的属性，可以设置多个

cookie的属性

- max-age和expires设置过期时间
- Secure只在https的时候发送
- HttpOnly 无法通过 document.cookie 访问 cookie

---

**cookies和session**

- cookies 是保存在客户端的小段文本 一般都是服务器端生成返回给客户端浏览器
- session 保存在服务器端，通过唯一的值sessionID来区分每一个用户，sessionID随每个连接请求发送到服务器，服务器更具sessionID来识别客户端，再通过session 的key值 获取 session 值
- 因为http是无状态的（这里的状态不是状态码那些东西，而是指的是服务器端不知道某个请求是哪个浏览器发的这类信息）

---

**token**

- 要下发到你的客户端，也要和
- 验证流程上和session不一样，是一个安全性更高的机制

---

## 🍓第四部分：HTTP2

优势：
- 信道复用：只建立一个TCP就行（可以并发很多HTTP）
- 使用二进制格式进行传输（不是传纯文本了，更加高效，紧凑）
- 对报头压缩，降低开销
- 多路复用，一个网络连接实现并行请求
- 服务器主动推送，减少请求的延迟（跟ajax，websocket）

---

## 🍎第五部分：Nginx

### 1.NGINX基础配置

> 纯粹的HTTP服务

- [Centos7.* 下安装NGINX](https://zhukunpenglinyutong.github.io/1.quickcheck/3.%E8%BF%90%E7%BB%B4/1.%E5%90%84%E7%A7%8D%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%80%9F%E6%9F%A5.html#%F0%9F%94%A5centos7-%E4%B8%8B%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6)


### 2.NGINX代理配置和代理缓存

---

## 🍇第六部分：Notes网站优化

> 先上来三板斧：gzip + CDN + HTTP2

我的网站访问速度，一度的飙升到1分半，这对于一个速查网站来说是致命的

经过我的分析，我发现是我的文件数量太多（130个左右），导致触及到了并发的最大数（谷歌浏览器只能并发6个TCP连接），于是我调整NGINX配置，使其变成 HTTP2 协议

呦，速度变成了1分钟，不错，咦不对，一分钟还是很慢，我接着分析返回的面板发现，并发数解决了，但是返回的网速依旧很慢，于是我查看服务器，发现我的服务器是 1MB/s ，哦，原来是网速限制了网站的速度呀，于是我准备替换成 CDN 静态加速

配置完成CDN + HTTP2，可以了，3s之内访问正常，先这样凑活用吧


---

## 📚参考列表（致敬）

- 《图解HTTP协议》
- [慕课网课程...HTTP协议原理+实践Web开发工程师必学](https://coding.imooc.com/learn/list/225.html)
- [腾讯课堂...前端全栈工程师精英班，个人强烈推荐...](https://ke.qq.com/course/220822)
- [腾讯课堂...前端next学位课程](https://ke.qq.com/course/233919)
- [HTTP报文分析](https://blog.csdn.net/qq_26565861/article/details/80969960)
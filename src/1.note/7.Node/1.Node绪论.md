# 1.Nodeç»ªè®º

## ğŸ¬ç¬¬ä¸€éƒ¨åˆ†ï¼šNodeå‘å±•å²

### 1.Nodeå‘å±•å†å²

::: tip
å‰è¨€ï¼šèƒ½ç”¨ JavaScript ç¼–å†™çš„ç¨‹åºï¼Œéƒ½ç»ˆå°†ä¼šä»¥ JavaScript ç¼–å†™

æˆ‘ä»¥å‰ä»¥ä¸ºè¿™å¥è¯æ˜¯ä¸ªç©ç¬‘è¯ï¼Œä½†æ˜¯éšè‘— Node.js çš„å‘å±•ï¼Œæˆ‘ä»¬æ¸æ¸åœ°æ˜ç™½åˆ°è¿™å¥è¯çš„è¿œè§æ€§â”€â”€JavaScript çœŸçš„è¶Šæ¥è¶Šå¼ºå¤§äº†ã€‚
:::

Node.jsè¯ç”Ÿè‡ª 2009 å¹´ï¼Œä½†æ˜¯å®ƒç¡®å®æœ‰å²ä»¥æ¥å‘å±•æœ€å¿«çš„å¼€å‘å·¥å…·ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚

- 2009å¹´3æœˆï¼šnode.js è¯ç”Ÿ
- 2009å¹´10æœˆï¼šIsaac Schlueterï¼ˆNodeçš„æ ¸å¿ƒç”¨æˆ·ï¼‰é¦–æ¬¡æå‡ºnpm
- 20010å¹´3æœˆï¼šexpress.js é—®ä¸–
- 2010å¹´3æœˆï¼šSocket.io ç¬¬ä¸€ç‰ˆå‘å¸ƒ
- 2011å¹´5æœˆï¼šnpm 1.0 å‘å¸ƒ
- ...

è¯ç”Ÿä¹‹åˆç»™ä¸šç•Œå¸¦æ¥ä¸¤ä¸ªå…ˆè¿›çš„æ€æƒ³ï¼šæ¨¡å—åŒ–ï¼ˆCommonJSï¼‰ï¼ŒåŒ…ç®¡ç†å·¥å…·ï¼ˆnpmï¼‰ï¼Œä¸å¯å¦è®¤ï¼Œè¿™äº›æ€æƒ³å·²ç»æˆä¸ºå‰ç«¯ä¸å¯ç¼ºå°‘çš„éƒ¨åˆ†ã€‚

å¹¶ä¸”å› ä¸ºNode.js ï¼Œå‰ç«¯æŒ£è„±äº†æµè§ˆå™¨çš„æŸç¼šï¼Œç›´æ¥å¯ä»¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿã€‚äºæ˜¯å¤§é‡çš„å·¥å…·è¯ç”Ÿ:gulpï¼Œwebpackï¼Œbabel... å¥ å®šäº†ç°ä»£å‰ç«¯çš„åŸºç¡€


### 2.Nodeæ˜¯ä»€ä¹ˆ

::: tip
å€Ÿç”¨Nodeå®˜ç½‘ä¸­çš„æè¿°ï¼šNode.js ä¸æ˜¯ JavaScriptåº”ç”¨ï¼Œä¸æ˜¯ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿä¸æ˜¯åƒNginxä¸€æ ·çš„webæœåŠ¡å™¨ï¼Œä¹Ÿä¸æ˜¯æ¡†æ¶ã€‚Node.js æ˜¯ JavaScript çš„è¿è¡Œæ—¶ç¯å¢ƒ

ä½ å¯ä»¥æŠŠNode.js ç†è§£æˆä¸€ä¸ªåº“ï¼ˆå½“ç„¶ç§°ä¹‹ä¸ºå¹³å°æ›´åˆç†ï¼‰ï¼Œä¾‹å¦‚jQueryï¼Œé‡Œé¢æœ‰å¾ˆå¤šæ–¹æ³•ï¼ˆAPIï¼‰ï¼Œåªè¦æƒ³è¾¾æˆæŸäº›æ•ˆæœï¼Œå°±è°ƒç”¨å¯¹åº”çš„æ–¹æ³•å³å¯
:::

> å¤‡æ³¨ï¼šNodeç°åœ¨ä¹Ÿè¢«åº”ç”¨äº äººå·¥æ™ºèƒ½ï¼ˆTensorFlow.jsï¼‰ & èˆªç©ºèˆªå¤©ï¼ˆCubeSatå«æ˜Ÿï¼‰& ç‰©è”ç½‘ï¼ˆRuffï¼Œæ ‘è“æ´¾ï¼‰

---


## ğŸ¡ç¬¬äºŒéƒ¨åˆ†ï¼šNodeï¼ˆioè¯»å†™æ¨¡å—åˆ†äº«ï¼‰

### 1.fsæ–‡ä»¶ç³»ç»Ÿ

::: tip
é¦–å…ˆ APIæ€»å…±æœ‰70å¤šä¸ªï¼Œä½†æ˜¯ä¸è¦æ…Œï¼Œè¿™ä¸ªæ•°é‡é™¤ä»¥äºŒå°±è¡Œï¼Œå› ä¸ºæ‰€æœ‰çš„æ–¹æ³•éƒ½æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§
:::

1.æ–‡ä»¶è¯»å–

```js
fs.readFile('', (err, data) => {
  console.log("åŒæ­¥è¯»å–: " + data);
})

let data = fs.readFileSync('');
```

---

2.æ–‡ä»¶å†™å…¥

```js
fs.writeFileSync('æ–‡ä»¶åœ°å€', 'è¦†ç›–å†™å…¥æ–‡æ¡ˆ') // è¦†ç›–å†™å…¥
fs.appendFileSync('æ–‡ä»¶åœ°å€', 'è¿½åŠ å†™å…¥æ–‡æ¡ˆ') // è¿½åŠ å†™å…¥
```

---

3.åˆ é™¤æ–‡ä»¶

```js
fs.unlinkSync('æ–‡ä»¶åœ°å€')
```

---

4.åˆ›å»ºç›®å½•

```js
fs.mkdirSync('ç›®å½•åœ°å€');
```

---

5.è¯»å–ç›®å½•

```js
fs.readdirSync('ç›®å½•åœ°å€');
```

---

6.åˆ é™¤ç›®å½•

```js
fs.rmdirSync('ç›®å½•åœ°å€');
```

---

7.è·å–æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ä¿¡æ¯

```js
let stats = fs.statSync('æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è·¯å¾„')
stats.isFile() // æ˜¯å¦æ˜¯æ–‡ä»¶
stats.isDirectory() // æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹
```

### 2.steamï¼ˆæµï¼‰

##### Nodeçš„æµæ“ä½œ ä¸»è¦æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ

- ä¸»è¦æ˜¯è¯»å†™æ“ä½œçš„ï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å–ï¼Œæ–‡ä»¶å†™å…¥ç­‰ç­‰
- è¿™é‡Œå¤§å®¶æ˜¯ä¸æ˜¯æ„Ÿè§‰å’Œä¸Šé¢çš„æ–‡ä»¶ç³»ç»ŸåŠŸèƒ½é‡å¤äº†ï¼Œç­”æ¡ˆæ˜¯ï¼Œæ˜¯çš„

---

##### ä¸ºä»€ä¹ˆæœ‰äº†æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼ˆfsï¼‰ï¼ŒNodeè¿˜è¦æœ‰ä¸ªæµæ¨¡å—å‘¢ï¼Ÿ

ä¾‹å¦‚ä¸Šé¢æˆ‘ä»¬çš„æ–‡ä»¶æ“ä½œç³»ç»Ÿä¸­çš„è¯»å–æ–‡ä»¶

```js
fs.readFileSync('').toString();
// å¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œæµå…¥500MBï¼Œå°±ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯
// buffer.js:382
//     throw new Error('toString failed');
// æŠ¥é”™åŸå› æ˜¯ Buffer å¯¹è±¡çš„é•¿åº¦è¿‡å¤§ï¼Œå¯¼è‡´toStringæ–¹æ³•å¤±è´¥ã€‚ å¯è§ï¼Œè¿™ç§ä¸€æ¬¡è·å–å…¨éƒ¨å†…å®¹çš„åšæ³•ï¼Œä¸é€‚åˆæ“ä½œå¤§æ–‡ä»¶ã€‚
```

å¯¹äºå¤§æ–‡ä»¶è¯»å– å¯ä»¥è€ƒè™‘ä½¿ç”¨æµæ¥è¯»å–æ–‡ä»¶å†…å®¹ã€‚

å…¶å®ä¸è¦è®¤ä¸ºæµæ¨¡å—åªèƒ½ç”¨æ¥è¯»ä¸€ä¸‹å¤§æ–‡ä»¶ï¼Œæµæ–‡ä»¶çš„æ„ä¹‰è¿˜åœ¨äºæµå¤„ç†è¿™ç§æ€è·¯ï¼Œå› ä¸ºNode.js å¾ˆæ˜¯è„†å¼±ã€‚Nodeè™½ç„¶å‘å±•å¾ˆå¿«ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªå¤§é—®é¢˜ä¸€ç›´å›°æ‰°ç€åƒæˆ‘è¿™æ ·çš„åˆçº§å¼€å‘è€…ï¼Œé‚£å°±æ˜¯ å®¹é”™å’Œæ€§èƒ½

å®¹é”™æŒ‡çš„æ˜¯ï¼šå› ä¸ºJSæ˜¯å•çº¿ç¨‹è§£é‡Šæ€§è¯­è¨€çš„ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªåœ°æ–¹æŠ¥é”™ï¼Œæ•´ä¸ªç³»ç»Ÿå°±æŒ‚æ‰äº†ï¼ˆç°åœ¨åˆpm2å¯ä»¥æŒ‚æ‰é‡å¯ï¼‰
æ€§èƒ½æŒ‡çš„æ˜¯ï¼šä¸€ä¸ªNodeç¨‹åºåªè¦æ¶‰åŠäº†IOæ“ä½œï¼Œä½ å•¥éƒ½æ²¡å¹²ä½ çš„å†…å­˜éƒ½æœ‰å¯èƒ½é£šçš„å¾ˆé«˜ã€‚å¦‚æœç”¨ä¼ ç»Ÿçš„fsè¿›è¡Œå¤§é‡æ–‡ä»¶è¯»å–ï¼Œç³»ç»Ÿç›´æ¥å°±ä¼šå¡æ­»ï¼Œæ‰€æœ‰æµå¤„ç†å¯¹IOæ“ä½œé«˜çš„ç³»ç»Ÿçš„ä¼˜åŒ–ï¼Œèµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ã€‚

è€Œ Node.js è‡ªå·±çš„å¤§é‡æ¨¡å— ä¹Ÿä½¿ç”¨äº† æµå¤„ç†æ¨¡å—ï¼Œä¾‹å¦‚httpæ¨¡å—ï¼Œè¿”å›æ•°æ®å°±ä½¿ç”¨äº†æµå¤„ç†æ¨¡å—ï¼Œä½†æ˜¯ä¸€æƒ³ä¹Ÿæ˜¯ï¼Œå¦‚æœæ²¡æœ‰æµå¤„ç†æ¨¡å—ï¼Œä½ ä»NodeæœåŠ¡å™¨ä¸Šä¸‹è½½ä¸€ä¸ª 4kè§†é¢‘ï¼ˆå‡ ä¸ªGçš„é‚£ç§ï¼‰ï¼Œç›´æ¥ä½ çš„å†…å­˜å°±å æ»¡äº†ï¼Œè€Œç”¨æµå¤„ç†å°±ä¸ä¼šæœ‰è¿™ç§æƒ…å†µã€‚


---

##### æµå¤„ç†ä¸ºå•¥è¿™ä¹ˆåŠï¼ŒåŸç†æ˜¯ä»€ä¹ˆï¼Œå®ƒå’Œfsæ¨¡å—ä¸åŒçš„æ˜¯ä»€ä¹ˆ

<img src="https://user-gold-cdn.xitu.io/2018/4/2/16284fe7a88515ca?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" />


---

##### Nodeæµå¤„ç†çš„ä½¿ç”¨

Node.js ä¸­æœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼ˆæˆ‘æ¥è®²å‰ä¸¤ç§ï¼‰

- Readable - å¯è¯»çš„æµ (ä¾‹å¦‚ fs.createReadStream())ã€‚
- Writable - å¯å†™çš„æµ (ä¾‹å¦‚ fs.createWriteStream())ã€‚
- Duplex - å¯è¯»å†™çš„æµï¼ˆåŒå·¥æµï¼‰ (ä¾‹å¦‚ net.Socket)ã€‚
- Transform - åœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹å’Œå˜æ¢æ•°æ®çš„ Duplex æµ (ä¾‹å¦‚ zlib.createDeflate())ã€‚

---

##### è¯»å–æµ

```js
// åˆ›å»ºå¯è¯»æµ
var readerStream = fs.createReadStream(PATH);

// è®¾ç½®ç¼–ç ä¸º utf8ã€‚
// readerStream.setEncoding('UTF8');

readerStream.on('data', function (chunk) {
  console.log('chunkï¼š', chunk)
});

readerStream.on('end', function () {
  console.log('end', data);
});
```

---

##### å†™å…¥æµ

```js
var fs = require("fs");
var data = 'æœ±æ˜†é¹';

// åˆ›å»ºä¸€ä¸ªå¯ä»¥å†™å…¥çš„æµï¼Œå†™å…¥åˆ°æ–‡ä»¶ output.txt ä¸­
var writerStream = fs.createWriteStream('output.txt');

// ä½¿ç”¨ utf8 ç¼–ç å†™å…¥æ•°æ®
writerStream.write(data,'UTF8');

// æ ‡è®°æ–‡ä»¶æœ«å°¾
writerStream.end();

// å¤„ç†æµäº‹ä»¶ --> data, end, and error
writerStream.on('finish', function() {
    console.log("å†™å…¥å®Œæˆã€‚");
});

writerStream.on('error', function(err){
   console.log(err.stack);
});

console.log("å†™å…¥ç¨‹åºæ‰§è¡Œå®Œæ¯•");
```

---

##### å¿«é€Ÿæ–‡ä»¶å¤åˆ¶

```js
let readable = fs.createReadStream('è¯»å–æ–‡ä»¶åœ°å€'); // åˆ›å»ºè¯»å–æµ
let writable = fs.createWriteStream('è¾“å‡ºæ–‡ä»¶åœ°å€'); // åˆ›å»ºå†™å…¥æµ
readable.pipe(writable); // é€šè¿‡ç®¡é“æ¥ä¼ è¾“æµ
```

---

## ğŸ§ç¬¬ä¸‰éƒ¨åˆ†ï¼šNodeï¼ˆioè¯»å†™æ¨¡å—å®é™…åº”ç”¨-H5æœ¬åœ°åŒ–å¹³å°ï¼‰

å…¬å¸éšç§ï¼Œä¸æ”¾è¿™ï¼Œå“ˆå“ˆå“ˆï¼Œæƒ³çœ‹æ¥åº”è˜å§

## ğŸ­ç¬¬å››éƒ¨åˆ†ï¼šä¸€äº›å°è£…å¥½çš„ioè¯»å†™æ¨¡å—å‡½æ•°åˆ†äº«


### 1.ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹è·¯å¾„ï¼Œè¿”å›è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶è·¯å¾„æ•°ç»„

```js
const fs = require('fs');

/**
 * ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹è·¯å¾„ï¼Œè¿”å›è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶è·¯å¾„æ•°ç»„
 * @param { String } æ–‡ä»¶å¤¹è·¯å¾„
 * @return { Array } æ­¤æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ç›¸å¯¹è·¯å¾„æ•°ç»„
 */
function readDirToPathArr(foldPath) {
  let pathArr = []

  function recursion(foldPath, children) {
    let files = fs.readdirSync(foldPath)
    files.forEach(item => {
      if (item === '.DS_Store') return;
      let isDir = fs.statSync(`${foldPath}/${item}`).isDirectory(); // æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹
      isDir
        ? recursion(`${foldPath}/${item}`)
        : pathArr.push(`${foldPath}/${item}`)
    })
  }

  recursion(foldPath)
  return pathArr
}
```

---

### 2.å¤åˆ¶æŸæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹

```js
/**
 * å¤åˆ¶æŸæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹
 * @param { String } è¢«å¤åˆ¶çš„æ–‡ä»¶å¤¹
 * @param { String } ç›®æ ‡æ–‡ä»¶å¤¹
 */
// å¤åˆ¶æ–‡ä»¶å¤¹
function exists (src, dst) {
  //æµ‹è¯•æŸä¸ªè·¯å¾„ä¸‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  fs.exists(dst, function(exists){
      if (exists) {//ä¸å­˜åœ¨
          copy(src,dst);
      } else {//å­˜åœ¨
          fs.mkdir(dst,function(){//åˆ›å»ºç›®å½•
              copy(src,dst)
          })
      }
  })
}

// å¤åˆ¶æ–‡ä»¶å¤¹çš„è¾…åŠ©å‡½æ•°
function copy (src, dst) {
  //è¯»å–ç›®å½•
  let paths = fs.readdirSync(src);
  paths.forEach(function(path){
      var _src=src+'/'+path;
      var _dst=dst+'/'+path;
      var readable;
      var writable;
      fs.stat(_src,function(err,st){
          if(err){
              throw err;
          }
          
          if(st.isFile()){
              readable=fs.createReadStream(_src);//åˆ›å»ºè¯»å–æµ
              writable=fs.createWriteStream(_dst);//åˆ›å»ºå†™å…¥æµ
              readable.pipe(writable);
          }else if(st.isDirectory()){
              exists(_src,_dst,copy);
          }
      });
  });
}

exists('./a', './b')
```

---

### 3.HTMLæ–‡æ¡ˆæŠ½ç¦»å‡½æ•°

```js
const cheerio = require('cheerio');
const fs = require('fs');
 
function extractFromText(data, options, cb) {
  var $, text;
 
  text = data.toString()
    .replace(/< *(br|p|div|section|aside|button|header|footer|li|article|blockquote|cite|code|h1|h2|h3|h4|h5|h6|legend|nav)((.*?)>)/g, '<$1$2|||||')
    .replace(/< *\/(td|a|option) *>/g, ' </$1>') // spacing some things out so text doesn't get smashed together
    .replace(/< *(a|td|option)/g, ' <$1') // spacing out links
    .replace(/< *(br|hr) +\/>/g, '|||||<$1\\>')
    .replace(/<\/ +?(p|div|section|aside|button|header|footer|li|article|blockquote|cite|code|h1|h2|h3|h4|h5|h6|legend|nav)>/g, '|||||</$1>');
 
  text = '<textractwrapper>' + text + '<textractwrapper>';
 
  try {
    $ = cheerio.load(text);
    $('script').remove();
    $('style').remove();
    $('noscript').remove();
 
    const $docElement = $('textractwrapper');
 
    if (options.includeAltText) {
      text = getTextWithAlt($, $docElement);
    } else {
      text = $docElement.text();
    }
 
    text = text.replace(/\|\|\|\|\|/g, '\n')
      .replace(/(\n\u00A0|\u00A0\n|\n | \n)+/g, '\n')
      .replace(/(\r\u00A0|\u00A0\r|\r | \r)+/g, '\n')
      .replace(/(\v\u00A0|\u00A0\v|\v | \v)+/g, '\n')
      .replace(/(\t\u00A0|\u00A0\t|\t | \t)+/g, '\n')
      .replace(/[\n\r\t\v]+/g, '\n')
      ;
  } catch (err) {
    cb(err, null);
    return;
  }
 
  cb(null, text);
}

// ä½¿ç”¨æ–¹æ³•
extractFromText(htmlæ–‡ä»¶çš„Bufferå¯¹è±¡æ•°æ®, {}, (err, resText) => {}) 
```
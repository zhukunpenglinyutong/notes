# 2.å„ç§è½¯ä»¶åŸºæœ¬ä½¿ç”¨é€ŸæŸ¥

---

## ğŸ”¥Nginxé€ŸæŸ¥

### Nginxåå‘ä»£ç†

- é¦–å…ˆ å®‰è£…ä¹‹åé…ç½®æ–‡ä»¶ä¸€èˆ¬éƒ½æ˜¯åœ¨ /etc/nginx ä¸‹çš„ nginx.confï¼Œè¿™ä¸ªä¸ç”¨åŠ¨
- ç„¶ååœ¨ /etc/nginx/conf.d æ–‡ä»¶å¤¹ä¸‹å»ºç«‹ä½ çš„ é¡¹ç›®å.confï¼ˆnginx.confä¼šæ‹¿ conf.d ä¸‹é¢çš„ .confæ–‡ä»¶çš„ï¼‰

```javascript

// æ–‡ä»¶æ ¼å¼ç¤ºä¾‹ - jl.conf

server {
  listen 80;//ç«¯å£ 80å°±è¡Œï¼Œå› ä¸ºè¦é ä¸‹é¢çš„ server_name æ¥æ‰¾
  server_name jl.itzkp.com; // åç§°
  location / {
    proxy_pass http://140.143.3.244:9999; // å°†ä¸Šé¢server_nameçš„å†…å®¹ è§£ææˆå…·ä½“çš„ç«¯å£
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Nginx-Proxy true;
    proxy_redirect off;
  }
}

// DNSè§£æç½‘å€ ---> æ‹¿åˆ°ip ---> Nginxç‹¬å 80ç«¯å£ ---> æ ¹æ®è¯·æ±‚ç½‘å€è¿”å›å¯¹åº”çš„ proxy_pass
// jl.itzkp.com ---> http://140.143.3.244 ---> Nginxç‹¬å 80ç«¯å£ ---> http://140.143.3.244:9999

```

---

### Nginxè´Ÿè½½å‡è¡¡

---

### Nginxå¸¸ç”¨å‘½ä»¤

- nginxé‡å¯ï¼šnginx -s reload
- 

---

## ğŸ”¥Dockerä½¿ç”¨

- dockerå®‰è£…ï¼ˆMacç³»ç»Ÿï¼‰ï¼š[Docker Desktop for Macå®˜ç½‘ä¸‹è½½åœ°å€](https://hub.docker.com/editions/community/docker-ce-desktop-mac)
- dockerå¸¸ç”¨å‘½ä»¤
    - è·å–é•œåƒï¼šdocker pull é•œåƒåç§°:ç‰ˆæœ¬å·
    - æŸ¥çœ‹å·²æœ‰é•œåƒï¼šdocker image ls
    - å¯åŠ¨å®¹å™¨ï¼šdocker run --name=xyls-centos -it -d -p 81:80 centos
        - --name=con_name è®¾ç½®å®¹å™¨åˆ«å
        - -it åœ¨å¯åŠ¨ä¹‹åè¿›å…¥è¿™ä¸ªå®¹å™¨ï¼ˆäº¤äº’å¼ï¼‰
        - -d æ”¾åˆ°åå°æ‰§è¡Œ
        - -p 80:80 æŠŠç‰©ç†æœº80ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„80ç«¯å£
    - å®¹å™¨æŒä¹…åŒ–å­˜å‚¨å’Œæ•°æ®å…±äº«
    - æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼šdocker ps
    - åˆ é™¤å®¹å™¨ï¼šdocker rm  con_name å¼ºåˆ¶åˆ é™¤éœ€è¦åŠ -fï¼Œä¸åŠ -fä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨ï¼Œéå¸¸å±é™©ï¼Œæœ€å¥½ä¸ç”¨
    - dockerä¿®æ”¹é•œåƒåï¼šdocker tag imageid name:tag

---

## ğŸ”¥pm2å¸¸ç”¨å‘½ä»¤

### å®‰è£…

- å®‰è£…pm2ï¼šnpm install pm2 -g
- æ›´æ–°pm2ï¼špm2 update
- ç§»é™¤pm2ï¼špm2 uninstall pm2

---

### å¼€å¯å…³é—­

- å¯åŠ¨server.jsè¿›ç¨‹ï¼špm2 start server.js
- å¯åŠ¨4ä¸ªserver.jsè¿›ç¨‹ï¼špm2 start server.js -i 4
- é‡å¯server.jsè¿›ç¨‹ï¼špm2 restart server.js
- åœæ­¢æ‰€æœ‰è¿›ç¨‹ï¼špm2 stop all 
- åœæ­¢server.jsè¿›ç¨‹ï¼špm2 stop server.js
- åœæ­¢ç¼–å·ä¸º0çš„è¿›ç¨‹ï¼špm2 stop 0
- åˆ é™¤pm2è¿›ç¨‹ï¼špm2 delete allï¼ˆä¹Ÿå¯ä»¥å†™å…·ä½“id,allæ˜¯åˆ é™¤æ‰€æœ‰ï¼‰

---

### é…ç½®å¯åŠ¨ä¿¡æ¯:

```javascript
//åˆ›å»ºapp.jsonï¼Œå†…å®¹å¦‚ä¸‹
{
  "apps" : [{
    "script"    : "server.js",  //è¿›ç¨‹å
    "instances" : "max",   //å¼€å¯è¿›ç¨‹æ•°ï¼Œå¯ä¸ºæ•°å€¼ï¼Œä¹Ÿå¯ä¸ºmaxã€‚ä¸æœåŠ¡å™¨cpuæ ¸æ•°ç›¸å…³
    "exec_mode" : "cluster" // å¯é€‰ï¼šfork(æœåŠ¡å™¨å•æ ¸æ¨è) cluster(å¤šæ ¸æ¨è)
  }]
}
pm2 start app.json
```

---

### æŸ¥çœ‹

- æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼špm2 list
- æŸ¥çœ‹æ‰§è¡Œç¼–å·ä¸º0çš„è¿›ç¨‹ï¼špm2 show 0

---

### å®æ—¶ç›‘æ§

- ç›‘æ§å½“å‰æ‰€æœ‰çš„è¿›ç¨‹ï¼špm2 monit
- ç›‘æ§æ‰¹è¯„è¡Œç¼–å·ä¸º0çš„è¿›ç¨‹ï¼špm2 monit 0
- ç›‘æ§ åç§° ä¸ºserver.jsçš„è¿›ç¨‹ï¼špm2 monit server.js

---

### æ—¥å¿—

- æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—ï¼špm2 logs
- æ˜¾ç¤ºæ‰§è¡Œç¼–å·ä¸º0çš„æ—¥å¿—ï¼špm2 logs 0
- æ˜¾ç¤ºåç§°ä¸ºserver.jsçš„è¿›ç¨‹ï¼špm2 logs server.js
- æ¸…æ´—æ‰€æœ‰çš„æ•°æ®ï¼špm2 flush


---


